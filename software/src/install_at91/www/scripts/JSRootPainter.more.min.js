(function(a){if(typeof define==="function"&&define.amd){define(["JSRootPainter","d3","JSRootMath"],a)}else{if(typeof exports==="object"&&typeof module!=="undefined"){a(require("./JSRootCore.js"),require("./d3.min.js"),require("./JSRootMath.js"))}else{if(typeof d3!="object"){throw new Error("This extension requires d3.v3.js","JSRootPainter.more.js")}if(typeof JSROOT=="undefined"){throw new Error("JSROOT is not defined","JSRootPainter.more.js")}if(typeof JSROOT.Painter!="object"){throw new Error("JSROOT.Painter not defined","JSRootPainter.more.js")}a(JSROOT,d3)}}}(function(a,b){a.sources.push("more2d");a.ToolbarIcons.th2color={recs:[{x:0,y:256,w:13,h:39,f:"rgb(38,62,168)"},{x:13,y:371,w:39,h:39},{y:294,h:39},{y:256,h:39},{y:218,h:39},{x:51,y:410,w:39,h:39},{y:371,h:39},{y:333,h:39},{y:294},{y:256,h:39},{y:218,h:39},{y:179,h:39},{y:141,h:39},{y:102,h:39},{y:64},{x:90,y:448,w:39,h:39},{y:410},{y:371,h:39},{y:333,h:39,f:"rgb(22,82,205)"},{y:294},{y:256,h:39,f:"rgb(16,100,220)"},{y:218,h:39},{y:179,h:39,f:"rgb(22,82,205)"},{y:141,h:39},{y:102,h:39,f:"rgb(38,62,168)"},{y:64},{y:0,h:27},{x:128,y:448,w:39,h:39},{y:410},{y:371,h:39},{y:333,h:39,f:"rgb(22,82,205)"},{y:294,f:"rgb(20,129,214)"},{y:256,h:39,f:"rgb(9,157,204)"},{y:218,h:39,f:"rgb(14,143,209)"},{y:179,h:39,f:"rgb(20,129,214)"},{y:141,h:39,f:"rgb(16,100,220)"},{y:102,h:39,f:"rgb(22,82,205)"},{y:64,f:"rgb(38,62,168)"},{y:26,h:39},{y:0,h:27},{x:166,y:486,h:14},{y:448,h:39},{y:410},{y:371,h:39,f:"rgb(22,82,205)"},{y:333,h:39,f:"rgb(20,129,214)"},{y:294,f:"rgb(82,186,146)"},{y:256,h:39,f:"rgb(179,189,101)"},{y:218,h:39,f:"rgb(116,189,129)"},{y:179,h:39,f:"rgb(82,186,146)"},{y:141,h:39,f:"rgb(14,143,209)"},{y:102,h:39,f:"rgb(16,100,220)"},{y:64,f:"rgb(38,62,168)"},{y:26,h:39},{x:205,y:486,w:39,h:14},{y:448,h:39},{y:410},{y:371,h:39,f:"rgb(16,100,220)"},{y:333,h:39,f:"rgb(9,157,204)"},{y:294,f:"rgb(149,190,113)"},{y:256,h:39,f:"rgb(244,198,59)"},{y:218,h:39},{y:179,h:39,f:"rgb(226,192,75)"},{y:141,h:39,f:"rgb(13,167,195)"},{y:102,h:39,f:"rgb(18,114,217)"},{y:64,f:"rgb(22,82,205)"},{y:26,h:39,f:"rgb(38,62,168)"},{x:243,y:448,w:39,h:39},{y:410},{y:371,h:39,f:"rgb(18,114,217)"},{y:333,h:39,f:"rgb(30,175,179)"},{y:294,f:"rgb(209,187,89)"},{y:256,h:39,f:"rgb(251,230,29)"},{y:218,h:39,f:"rgb(249,249,15)"},{y:179,h:39,f:"rgb(226,192,75)"},{y:141,h:39,f:"rgb(30,175,179)"},{y:102,h:39,f:"rgb(18,114,217)"},{y:64,f:"rgb(38,62,168)"},{y:26,h:39},{x:282,y:448,h:39},{y:410},{y:371,h:39,f:"rgb(18,114,217)"},{y:333,h:39,f:"rgb(14,143,209)"},{y:294,f:"rgb(149,190,113)"},{y:256,h:39,f:"rgb(226,192,75)"},{y:218,h:39,f:"rgb(244,198,59)"},{y:179,h:39,f:"rgb(149,190,113)"},{y:141,h:39,f:"rgb(9,157,204)"},{y:102,h:39,f:"rgb(18,114,217)"},{y:64,f:"rgb(38,62,168)"},{y:26,h:39},{x:320,y:448,w:39,h:39},{y:410},{y:371,h:39,f:"rgb(22,82,205)"},{y:333,h:39,f:"rgb(20,129,214)"},{y:294,f:"rgb(46,183,164)"},{y:256,h:39},{y:218,h:39,f:"rgb(82,186,146)"},{y:179,h:39,f:"rgb(9,157,204)"},{y:141,h:39,f:"rgb(20,129,214)"},{y:102,h:39,f:"rgb(16,100,220)"},{y:64,f:"rgb(38,62,168)"},{y:26,h:39},{x:358,y:448,h:39},{y:410},{y:371,h:39,f:"rgb(22,82,205)"},{y:333,h:39},{y:294,f:"rgb(16,100,220)"},{y:256,h:39,f:"rgb(20,129,214)"},{y:218,h:39,f:"rgb(14,143,209)"},{y:179,h:39,f:"rgb(18,114,217)"},{y:141,h:39,f:"rgb(22,82,205)"},{y:102,h:39,f:"rgb(38,62,168)"},{y:64},{y:26,h:39},{x:397,y:448,w:39,h:39},{y:371,h:39},{y:333,h:39},{y:294,f:"rgb(22,82,205)"},{y:256,h:39},{y:218,h:39},{y:179,h:39,f:"rgb(38,62,168)"},{y:141,h:39},{y:102,h:39},{y:64},{y:26,h:39},{x:435,y:410,h:39},{y:371,h:39},{y:333,h:39},{y:294},{y:256,h:39},{y:218,h:39},{y:179,h:39},{y:141,h:39},{y:102,h:39},{y:64},{x:474,y:256,h:39},{y:179,h:39}]};a.ToolbarIcons.th2colorz={recs:[{x:128,y:486,w:256,h:26,f:"rgb(38,62,168)"},{y:461,f:"rgb(22,82,205)"},{y:435,f:"rgb(16,100,220)"},{y:410,f:"rgb(18,114,217)"},{y:384,f:"rgb(20,129,214)"},{y:358,f:"rgb(14,143,209)"},{y:333,f:"rgb(9,157,204)"},{y:307,f:"rgb(13,167,195)"},{y:282,f:"rgb(30,175,179)"},{y:256,f:"rgb(46,183,164)"},{y:230,f:"rgb(82,186,146)"},{y:205,f:"rgb(116,189,129)"},{y:179,f:"rgb(149,190,113)"},{y:154,f:"rgb(179,189,101)"},{y:128,f:"rgb(209,187,89)"},{y:102,f:"rgb(226,192,75)"},{y:77,f:"rgb(244,198,59)"},{y:51,f:"rgb(253,210,43)"},{y:26,f:"rgb(251,230,29)"},{y:0,f:"rgb(249,249,15)"}]};a.ToolbarIcons.th2draw3d={path:"M172.768,0H51.726C23.202,0,0.002,23.194,0.002,51.712v89.918c0,28.512,23.2,51.718,51.724,51.718h121.042   c28.518,0,51.724-23.2,51.724-51.718V51.712C224.486,23.194,201.286,0,172.768,0z M177.512,141.63c0,2.611-2.124,4.745-4.75,4.745   H51.726c-2.626,0-4.751-2.134-4.751-4.745V51.712c0-2.614,2.125-4.739,4.751-4.739h121.042c2.62,0,4.75,2.125,4.75,4.739 L177.512,141.63L177.512,141.63z M460.293,0H339.237c-28.521,0-51.721,23.194-51.721,51.712v89.918c0,28.512,23.2,51.718,51.721,51.718h121.045   c28.521,0,51.721-23.2,51.721-51.718V51.712C512.002,23.194,488.802,0,460.293,0z M465.03,141.63c0,2.611-2.122,4.745-4.748,4.745   H339.237c-2.614,0-4.747-2.128-4.747-4.745V51.712c0-2.614,2.133-4.739,4.747-4.739h121.045c2.626,0,4.748,2.125,4.748,4.739 V141.63z M172.768,256.149H51.726c-28.524,0-51.724,23.205-51.724,51.726v89.915c0,28.504,23.2,51.715,51.724,51.715h121.042   c28.518,0,51.724-23.199,51.724-51.715v-89.915C224.486,279.354,201.286,256.149,172.768,256.149z M177.512,397.784   c0,2.615-2.124,4.736-4.75,4.736H51.726c-2.626-0.006-4.751-2.121-4.751-4.736v-89.909c0-2.626,2.125-4.753,4.751-4.753h121.042 c2.62,0,4.75,2.116,4.75,4.753L177.512,397.784L177.512,397.784z M460.293,256.149H339.237c-28.521,0-51.721,23.199-51.721,51.726v89.915c0,28.504,23.2,51.715,51.721,51.715h121.045   c28.521,0,51.721-23.199,51.721-51.715v-89.915C512.002,279.354,488.802,256.149,460.293,256.149z M465.03,397.784   c0,2.615-2.122,4.736-4.748,4.736H339.237c-2.614,0-4.747-2.121-4.747-4.736v-89.909c0-2.626,2.121-4.753,4.747-4.753h121.045 c2.615,0,4.748,2.116,4.748,4.753V397.784z"};a.Painter.CreateDefaultPalette=function(){function l(x,w,A){var o,y,z;if(A<1e-300){o=y=z=w}else{function v(B,s,r){if(r<0){r+=1}if(r>1){r-=1}if(r<1/6){return B+(s-B)*6*r}if(r<1/2){return s}if(r<2/3){return B+(s-B)*(2/3-r)*6}return B}var t=w<0.5?w*(1+A):w+A-w*A;var u=2*w-t;o=v(u,t,x+1/3);y=v(u,t,x);z=v(u,t,x-1/3)}return"rgb("+Math.round(o*255)+","+Math.round(y*255)+","+Math.round(z*255)+")"}var d=[],g=1,m=0.5,e=280,c=0,k=50;for(var f=0;f<k;++f){var h=(e-(f+1)*((e-c)/k))/360;var j=l(h,m,g);d.push(j)}return d};a.Painter.CreateGrayPalette=function(){var c=[];for(var d=0;d<50;++d){var e=Math.round((d+2)/60*255);c.push("rgb("+e+","+e+","+e+")")}return c};a.Painter.CreateGradientColorTable=function(q,l,d,e,o,k){var j=[];for(var m=1;m<q.length;m++){var h=parseInt(Math.floor(o*q[m])-Math.floor(o*q[m-1]));for(var p=0;p<h;p++){var f=Math.round(l[m-1]+p*(l[m]-l[m-1])/h)+","+Math.round(d[m-1]+p*(d[m]-d[m-1])/h)+","+Math.round(e[m-1]+p*(e[m]-e[m-1])/h);j.push("rgb("+f+")")}}return j};a.Painter.GetColorPalette=function(d,h){if((d===null)||(d===0)){d=a.gStyle.Palette}if((d>0)&&(d<10)){return a.Painter.CreateGrayPalette()}if(d<51){return a.Painter.CreateDefaultPalette()}if(d>112){d=57}var g,f,c,e=[0,0.125,0.25,0.375,0.5,0.625,0.75,0.875,1];switch(d){case 51:g=[0,9,13,17,24,32,27,25,29];f=[0,0,0,2,37,74,113,160,221];c=[28,42,59,78,98,129,154,184,221];break;case 52:g=[0,32,64,96,128,160,192,224,255];f=[0,32,64,96,128,160,192,224,255];c=[0,32,64,96,128,160,192,224,255];break;case 53:g=[0,45,99,156,212,230,237,234,242];f=[0,0,0,45,101,168,238,238,243];c=[0,1,1,3,9,8,11,95,230];break;case 54:g=[0,22,44,68,93,124,160,192,237];f=[0,16,41,67,93,125,162,194,241];c=[97,100,99,99,93,68,44,26,74];break;case 55:g=[0,5,15,35,102,196,208,199,110];f=[0,48,124,192,206,226,97,16,0];c=[99,142,198,201,90,22,13,8,2];break;case 56:g=[242,234,237,230,212,156,99,45,0];f=[243,238,238,168,101,45,0,0,0];c=[230,95,11,8,9,3,1,1,0];break;case 57:g=[0.2082*255,0.0592*255,0.078*255,0.0232*255,0.1802*255,0.5301*255,0.8186*255,0.9956*255,0.9764*255];f=[0.1664*255,0.3599*255,0.5041*255,0.6419*255,0.7178*255,0.7492*255,0.7328*255,0.7862*255,0.9832*255];c=[0.5293*255,0.8684*255,0.8385*255,0.7914*255,0.6425*255,0.4662*255,0.3499*255,0.1968*255,0.0539*255];break;case 58:g=[0,0.0956*255,0.0098*255,0.2124*255,0.6905*255,0.9242*255,0.7914*255,0.7596*255,1*255];f=[0,0.1147*255,0.3616*255,0.5041*255,0.4577*255,0.4691*255,0.6905*255,0.9237*255,1*255];c=[0,0.2669*255,0.3121*255,0.1318*255,0.2236*255,0.6741*255,0.9882*255,0.9593*255,1*255];break;case 59:g=[13,23,25,63,76,104,137,161,206];f=[95,67,37,21,0,12,35,52,79];c=[4,3,2,6,11,22,49,98,208];break;case 60:g=[0,61,89,122,143,160,185,204,231];f=[0,0,0,0,14,37,72,132,235];c=[0,140,224,144,4,5,6,9,13];break;case 61:g=[14,7,2,0,5,11,55,131,229];f=[105,56,26,1,42,74,131,171,229];c=[2,21,35,60,92,113,160,185,229];break;case 62:g=[0,0,0,70,148,231,235,237,244];f=[0,0,0,0,0,69,67,216,244];c=[0,102,228,231,177,124,137,20,244];break;case 63:g=[50,56,63,68,93,121,165,192,241];f=[66,81,91,96,111,128,155,189,241];c=[97,91,75,65,77,103,143,167,217];break;case 64:g=[145,166,167,156,131,114,101,112,132];f=[158,178,179,181,163,154,144,152,159];c=[190,199,201,192,176,169,160,166,190];break;case 65:g=[93,91,99,108,130,125,132,155,174];f=[126,124,128,129,131,121,119,153,173];c=[103,94,87,85,80,85,107,120,146];break;case 66:g=[24,40,69,90,104,114,120,132,103];f=[29,52,94,127,150,162,159,151,101];c=[29,52,96,132,162,181,184,186,131];break;case 67:g=[46,38,61,92,113,121,132,150,191];f=[46,36,40,69,110,135,131,92,34];c=[46,80,74,70,81,105,165,211,225];break;case 68:g=[0,4,12,30,52,101,142,190,237];f=[0,40,86,121,140,172,187,213,240];c=[0,9,14,18,21,23,27,35,101];break;case 69:g=[198,206,206,211,198,181,161,171,244];f=[103,133,150,172,178,174,163,175,244];c=[49,54,55,66,91,130,184,224,244];break;case 70:g=[243,243,240,240,241,239,186,151,129];f=[0,46,99,149,194,220,183,166,147];c=[6,8,36,91,169,235,246,240,233];break;case 71:g=[22,19,19,25,35,53,88,139,210];f=[0,32,69,108,135,159,183,198,215];c=[77,96,110,116,110,100,90,78,70];break;case 72:g=[68,116,165,182,189,180,145,111,71];f=[37,82,135,178,204,225,221,202,147];c=[16,55,105,147,196,226,232,224,178];break;case 73:g=[61,99,136,181,213,225,198,136,24];f=[149,140,96,83,132,178,190,135,22];c=[214,203,168,135,110,100,111,113,22];break;case 74:g=[76,120,156,183,197,180,162,154,140];f=[34,35,42,69,102,137,164,188,197];c=[64,69,78,105,142,177,205,217,198];break;case 75:g=[37,102,157,188,196,214,223,235,251];f=[37,29,25,37,67,91,132,185,251];c=[37,32,33,45,66,98,137,187,251];break;case 76:g=[79,100,119,137,153,172,192,205,250];f=[63,79,93,103,115,135,167,196,250];c=[51,59,66,61,62,70,110,160,250];break;case 77:g=[43,44,50,66,125,172,178,155,157];f=[63,63,85,101,138,163,122,51,39];c=[121,101,58,44,47,55,57,44,43];break;case 78:g=[0,41,62,79,90,87,99,140,228];f=[0,57,81,93,85,70,71,125,228];c=[95,91,91,82,60,43,44,112,228];break;case 79:g=[49,59,72,88,114,141,176,205,222];f=[78,72,66,57,59,75,106,142,173];c=[78,55,46,40,39,39,40,41,47];break;case 80:g=[243,222,201,185,165,158,166,187,219];f=[94,108,132,135,125,96,68,51,61];c=[7,9,12,19,45,89,118,146,118];break;case 81:g=[19,44,74,105,137,166,194,206,220];f=[19,28,40,55,82,110,159,181,220];c=[19,42,68,96,129,157,188,203,220];break;case 82:g=[33,44,70,99,140,165,199,211,216];f=[38,50,76,105,140,165,191,189,167];c=[55,67,97,124,140,166,163,129,52];break;case 83:g=[0,33,73,124,136,152,159,171,223];f=[0,43,92,124,134,126,121,144,223];c=[0,43,68,76,73,64,72,114,223];break;case 84:g=[5,18,45,124,193,223,205,128,49];f=[48,134,207,230,193,113,28,0,7];c=[6,15,41,121,193,226,208,130,49];break;case 85:g=[180,106,104,135,164,188,189,165,144];f=[72,126,154,184,198,207,205,190,179];c=[41,120,158,188,194,181,145,100,62];break;case 86:g=[57,72,94,117,136,154,174,192,215];f=[0,33,68,109,140,171,192,196,209];c=[116,137,173,201,200,201,203,190,187];break;case 87:g=[31,71,123,160,210,222,214,199,183];f=[40,117,171,211,231,220,190,132,65];c=[234,214,228,222,210,160,105,60,34];break;case 88:g=[123,108,109,126,154,172,188,196,218];f=[184,138,130,133,154,175,188,196,218];c=[208,130,109,99,110,122,150,171,218];break;case 89:g=[105,106,122,143,159,172,176,181,207];f=[252,197,194,187,174,162,153,136,125];c=[146,133,144,155,163,167,166,162,174];break;case 90:g=[171,141,145,152,154,159,163,158,177];f=[236,143,100,63,53,55,44,31,6];c=[59,48,46,44,42,54,82,112,179];break;case 91:g=[180,190,209,223,204,228,205,152,91];f=[93,125,147,172,181,224,233,198,158];c=[236,218,160,133,114,132,162,220,218];break;case 92:g=[225,183,162,135,115,111,119,145,211];f=[205,177,166,135,124,117,117,132,172];c=[186,165,155,135,126,130,150,178,226];break;case 93:g=[39,43,59,63,80,116,153,177,223];f=[39,43,59,74,91,114,139,165,223];c=[39,50,59,70,85,115,151,176,223];break;case 94:g=[0,38,60,76,84,89,101,128,204];f=[0,10,15,23,35,57,83,123,199];c=[0,11,22,40,63,86,97,94,85];break;case 95:g=[94,112,141,165,167,140,91,49,27];f=[27,46,88,135,166,161,135,97,58];c=[42,52,81,106,139,158,155,137,116];break;case 96:g=[30,49,79,117,135,151,146,138,147];f=[63,60,72,90,94,94,68,46,16];c=[18,28,41,56,62,63,50,36,21];break;case 97:g=[0,30,63,101,143,152,169,187,230];f=[0,14,28,42,58,61,67,74,91];c=[39,26,21,18,15,14,14,13,13];break;case 98:g=[149,140,164,179,182,181,131,87,61];f=[62,70,107,136,144,138,117,87,74];c=[40,38,45,49,49,49,38,32,34];break;case 99:g=[99,112,148,165,179,182,183,183,208];f=[39,40,57,79,104,127,148,161,198];c=[15,16,18,33,51,79,103,129,177];break;case 100:g=[99,116,154,174,200,196,201,201,230];f=[0,0,8,32,58,83,119,136,173];c=[5,6,7,9,9,14,17,19,24];break;case 101:g=[82,106,126,141,155,163,142,107,66];f=[62,44,69,107,135,152,149,132,119];c=[39,25,31,60,73,68,49,72,188];break;case 102:g=[18,29,44,72,116,158,184,208,221];f=[27,46,71,105,146,177,189,190,183];c=[39,55,80,108,130,133,124,100,76];break;case 103:g=[0,48,119,173,212,224,228,228,245];f=[0,13,30,47,79,127,167,205,245];c=[0,68,75,43,16,22,55,128,245];break;case 104:g=[34,70,129,187,225,226,216,193,179];f=[48,91,147,194,226,229,196,110,12];c=[234,212,216,224,206,110,53,40,29];break;case 105:g=[30,55,103,147,174,203,188,151,105];f=[0,65,138,182,187,175,121,53,9];c=[191,202,212,208,171,140,97,57,30];break;case 106:g=[112,97,113,125,138,159,178,188,225];f=[16,17,24,37,56,81,110,136,189];c=[38,35,46,59,78,103,130,152,201];break;case 107:g=[18,72,5,23,29,201,200,98,29];f=[0,0,43,167,211,117,0,0,0];c=[51,203,177,26,10,9,8,3,0];break;case 108:g=[19,42,64,88,118,147,175,187,205];f=[19,55,89,125,154,169,161,129,70];c=[19,32,47,70,100,128,145,130,75];break;case 109:g=[33,31,42,68,86,111,141,172,227];f=[255,175,145,106,88,55,15,0,0];c=[255,205,202,203,208,205,203,206,231];break;case 110:g=[0,25,50,79,110,145,181,201,254];f=[0,16,30,46,63,82,101,124,179];c=[0,12,21,29,39,49,61,74,103];break;case 111:g=[0,13,30,44,72,120,156,200,247];f=[0,36,84,117,141,153,151,158,247];c=[0,94,100,82,56,66,76,131,247];break;case 112:g=[26,51,43,33,28,35,74,144,246];f=[9,24,55,87,118,150,180,200,222];c=[30,96,112,114,112,101,72,35,0];break;default:return a.Painter.CreateDefaultPalette()}return a.Painter.CreateGradientColorTable(e,g,f,c,255,h)};a.Painter.drawEllipse=function(e,d,c){this.SetDivId(e,2);this.Redraw=function(){var k=this.GetObject();if(!this.lineatt){this.lineatt=a.Painter.createAttLine(k)}if(!this.fillatt){this.fillatt=this.createAttFill(k)}this.RecreateDrawG(true,"text_layer");var s=this.AxisToSvg("x",k.fX1,false),q=this.AxisToSvg("y",k.fY1,false),j=this.AxisToSvg("x",k.fX1+k.fR1,false)-s,g=q-this.AxisToSvg("y",k.fY1+k.fR2,false);if((k.fPhimin==0)&&(k.fPhimax==360)&&(k.fTheta==0)){this.draw_g.append("svg:ellipse").attr("cx",s).attr("cy",q).attr("rx",j).attr("ry",g).call(this.lineatt.func).call(this.fillatt.func);return}var o=Math.cos(Math.PI*k.fTheta/180);var v=Math.sin(Math.PI*k.fTheta/180);var u=j*Math.cos(k.fPhimin*Math.PI/180);var m=g*Math.sin(k.fPhimin*Math.PI/180);var h=u*o-m*v;var r=-u*v-m*o;var t=j*Math.cos(k.fPhimax*Math.PI/180);var l=g*Math.sin(k.fPhimax*Math.PI/180);var f=t*o-l*v;var p=-t*v-l*o;this.draw_g.attr("transform","translate("+s.toFixed(1)+","+q.toFixed(1)+")").append("svg:path").attr("d","M 0,0 L "+h.toFixed(1)+","+r.toFixed(1)+" A "+j.toFixed(1)+" "+g.toFixed(1)+" "+-k.fTheta.toFixed(1)+" 1 0 "+f.toFixed(1)+","+p.toFixed(1)+" L 0,0 Z").call(this.lineatt.func).call(this.fillatt.func)};this.Redraw();return this.DrawingReady()};a.Painter.drawLine=function(e,d,c){this.SetDivId(e,2);this.Redraw=function(){var h=this.GetObject(),g=a.Painter.createAttLine(h),j=a.BIT(14),f=h.TestBit(j);this.RecreateDrawG(true,"text_layer");this.draw_g.append("svg:line").attr("x1",this.AxisToSvg("x",h.fX1,f)).attr("y1",this.AxisToSvg("y",h.fY1,f)).attr("x2",this.AxisToSvg("x",h.fX2,f)).attr("y2",this.AxisToSvg("y",h.fY2,f)).call(g.func)};this.Redraw();return this.DrawingReady()};a.Painter.drawPolyLine=function(e,d,c){this.SetDivId(e,2);this.Redraw=function(){var j=this.GetObject(),h=a.Painter.createAttLine(j),k=this.createAttFill(j),g=a.BIT(14),f=j.TestBit(g),l="";this.RecreateDrawG(true,"text_layer");for(var m=0;m<=j.fLastPoint;++m){l+=((m>0)?"L":"M")+this.AxisToSvg("x",j.fX[m],f)+","+this.AxisToSvg("y",j.fY[m],f)}if(k.color!=="none"){l+="Z"}this.draw_g.append("svg:path").attr("d",l).call(h.func).call(k.func)};this.Redraw();return this.DrawingReady()};a.Painter.drawBox=function(e,d,c){this.SetDivId(e,2);this.Redraw=function(){var m=this.GetObject(),f=a.Painter.createAttLine(m),l=this.createAttFill(m);this.RecreateDrawG(true,"text_layer");var h=this.AxisToSvg("x",m.fX1,false),g=this.AxisToSvg("x",m.fX2,false),k=this.AxisToSvg("y",m.fY1,false),j=this.AxisToSvg("y",m.fY2,false);if((l.color!="none")&&!this.draw_line){f.color="none"}this.draw_g.append("svg:rect").attr("x",Math.min(h,g)).attr("y",Math.min(k,j)).attr("width",Math.abs(g-h)).attr("height",Math.abs(k-j)).call(f.func).call(l.func)};this.draw_line=(typeof c=="string")&&(c.toUpperCase().indexOf("L")>=0);this.Redraw();return this.DrawingReady()};a.Painter.drawMarker=function(d,c){this.SetDivId(d,2);this.Redraw=function(){var g=this.GetObject(),h=a.Painter.createAttMarker(g),j=a.BIT(14),f=g.TestBit(j);this.RecreateDrawG(true,"text_layer");var e=this.AxisToSvg("x",g.fX,f),l=this.AxisToSvg("y",g.fY,f);var k=h.create(e,l);if(k&&k.length>0){this.draw_g.append("svg:path").attr("d",k).call(h.func)}};this.Redraw();return this.DrawingReady()};a.Painter.drawArrow=function(e,d,c){this.SetDivId(e,2);this.Redraw=function(){var l=this.GetObject();if(!this.lineatt){this.lineatt=a.Painter.createAttLine(l)}if(!this.fillatt){this.fillatt=this.createAttFill(l)}var f=Math.max(this.pad_width(),this.pad_height())*l.fArrowSize;if(f<3){f=3}var x=f*Math.tan(l.fAngle/2*(Math.PI/180));this.RecreateDrawG(true,"text_layer");var A=this.AxisToSvg("x",l.fX1,false),m=this.AxisToSvg("y",l.fY1,false),z=this.AxisToSvg("x",l.fX2,false),j=this.AxisToSvg("y",l.fY2,false),g="M0,0 L"+f.toFixed(1)+","+x.toFixed(1)+" L0,"+(x*2).toFixed(1),t="M"+f.toFixed(1)+", 0 L 0,"+x.toFixed(1)+" L "+f.toFixed(1)+","+(x*2).toFixed(1),p=null,q=null,v=null,h=null,u=l.fOption,y=u.length;if(u.indexOf("<")==0){var k=(u.indexOf("<|")==0);if(!h){h=this.draw_g.append("defs")}p="jsroot_arrowmarker_"+a.Painter.arrowcnt++;var s=h.append("svg:marker").attr("id",p).attr("markerWidth",f.toFixed(1)).attr("markerHeight",(x*2).toFixed(1)).attr("refX","0").attr("refY",x.toFixed(1)).attr("orient","auto").attr("markerUnits","userSpaceOnUse").append("svg:path").style("fill","none").attr("d",t+(k?" Z":"")).call(this.lineatt.func);if(k){s.call(this.fillatt.func)}}var r=0;if(u.indexOf("->-")>=0){r=1}else{if(u.indexOf("-|>-")>=0){r=11}else{if(u.indexOf("-<-")>=0){r=2}else{if(u.indexOf("-<|-")>=0){r=12}}}}if(r>0){var k=r>10;if(!h){h=this.draw_g.append("defs")}q="jsroot_arrowmarker_"+a.Painter.arrowcnt++;var B=h.append("svg:marker").attr("id",q).attr("markerWidth",f.toFixed(1)).attr("markerHeight",(x*2).toFixed(1)).attr("refX",(f*0.5).toFixed(1)).attr("refY",x.toFixed(1)).attr("orient","auto").attr("markerUnits","userSpaceOnUse").append("svg:path").style("fill","none").attr("d",((r%10==1)?g:t)+((r>10)?" Z":"")).call(this.lineatt.func);if(r>10){B.call(this.fillatt.func)}}if(u.lastIndexOf(">")==y-1){var k=(u.lastIndexOf("|>")==y-2)&&(y>1);if(!h){h=this.draw_g.append("defs")}v="jsroot_arrowmarker_"+a.Painter.arrowcnt++;var o=h.append("svg:marker").attr("id",v).attr("markerWidth",f.toFixed(1)).attr("markerHeight",(x*2).toFixed(1)).attr("refX",f.toFixed(1)).attr("refY",x.toFixed(1)).attr("orient","auto").attr("markerUnits","userSpaceOnUse").append("svg:path").style("fill","none").attr("d",g+(k?" Z":"")).call(this.lineatt.func);if(k){o.call(this.fillatt.func)}}var w=this.draw_g.append("svg:path").attr("d","M"+A+","+m+((q==null)?"":"L"+(A/2+z/2).toFixed(1)+","+(m/2+j/2).toFixed(1))+" L"+z+","+j).call(this.lineatt.func);if(p){w.style("marker-start","url(#"+p+")")}if(q){w.style("marker-mid","url(#"+q+")")}if(v){w.style("marker-end","url(#"+v+")")}};if(!a.Painter.arrowcnt){a.Painter.arrowcnt=1}this.Redraw();return this.DrawingReady()};a.Painter.drawRooPlot=function(h,f,e){var c=this,d=-1;function g(){if(++d>=f._items.arr.length){return c.DrawingReady()}a.draw(h,f._items.arr[d],f._items.opt[d],g)}a.draw(h,f._hist,"hist",g);return this};a.Painter.drawTF2=function(p,f,e){var o=null,s=0,q=0,c=1,m=new a.DrawOptions(e);if(m.check("NOSAVE")){c=0}if(!f.fSave||f.fSave.length<7||!c){c=0}else{c=f.fSave.length;s=Math.round(f.fSave[c-2]);q=Math.round(f.fSave[c-1]);if(c!==(s+1)*(q+1)+6){c=0}}if(c>6){var v=(f.fSave[c-5]-f.fSave[c-6])/s/2,u=(f.fSave[c-3]-f.fSave[c-4])/q/2;o=a.CreateHistogram("TH2F",s+1,q+1);o.fXaxis.fXmin=f.fSave[c-6]-v;o.fXaxis.fXmax=f.fSave[c-5]+v;o.fYaxis.fXmin=f.fSave[c-4]-u;o.fYaxis.fXmax=f.fSave[c-3]+u;var g=0;for(var h=0;h<=q;++h){for(var l=0;l<=s;++l){o.setBinContent(o.getBin(l+1,h+1),f.fSave[g++])}}}else{s=Math.max(f.fNpx,2);q=Math.max(f.fNpy,2);o=a.CreateHistogram("TH2F",s,q);o.fXaxis.fXmin=f.fXmin;o.fXaxis.fXmax=f.fXmax;o.fYaxis.fXmin=f.fYmin;o.fYaxis.fXmax=f.fYmax;for(var h=0;h<q;++h){for(var l=0;l<s;++l){var t=f.fXmin+(l+0.5)*(f.fXmax-f.fXmin)/s,r=f.fYmin+(h+0.5)*(f.fYmax-f.fYmin)/q;o.setBinContent(o.getBin(l+1,h+1),f.evalPar(t,r))}}}o.fName="Func";o.fTitle=f.fTitle;o.fMinimum=f.fMinimum;o.fMaximum=f.fMaximum;o.fLineColor=f.fLineColor;o.fLineStyle=f.fLineStyle;o.fLineWidth=f.fLineWidth;o.fFillColor=f.fFillColor;o.fFillStyle=f.fFillStyle;o.fMarkerColor=f.fMarkerColor;o.fMarkerStyle=f.fMarkerStyle;o.fMarkerSize=f.fMarkerSize;if(m.empty()){e="cont3"}else{if(m.opt==="SAME"){e="cont2 same"}else{e=m.opt}}return a.Painter.drawHistogram2D.call(this,p,o,e)};a.Painter.drawFunction=function(g,f,c){this.bins=null;this.Eval=function(d){return this.GetObject().evalPar(d)};this.CreateBins=function(v){var m=this.main_painter(),j=0,p=0,q=this.GetObject();if((m!==null)&&!v){if(m.zoom_xmin!==m.zoom_xmax){j=m.zoom_xmin;p=m.zoom_xmax}else{j=m.xmin;p=m.xmax}}if((q.fSave.length>0)&&!this.nosave){var t=q.fSave.length-2,h=q.fSave[t],o=q.fSave[t+1],w=(o-h)/(t-1),s=[];for(var k=0;k<t;++k){var d=h+w*k;if((j!==p)&&((d+2*w<j)||(d-2*w>p))){continue}var r=q.fSave[k];if(!isNaN(r)){s.push({x:d,y:r})}}return s}var h=q.fXmin,o=q.fXmax,u=false,l=this.root_pad();if(j!==p){if(j>h){h=j}if(p<o){o=p}}if((m!==null)&&m.logx&&(h>0)&&(o>0)){u=true;h=Math.log(h);o=Math.log(o)}var t=Math.max(q.fNpx,101),w=(o-h)/(t-1),s=[];for(var k=0;k<t;k++){var d=h+k*w;if(u){d=Math.exp(d)}var r=this.Eval(d);if(!isNaN(r)){s.push({x:d,y:r})}}return s};this.CreateDummyHisto=function(){var m=0,j=1,k=0,d=1,l=this.CreateBins(true);if((l!==null)&&(l.length>0)){m=j=l[0].x;k=d=l[0].y;l.forEach(function(q){m=Math.min(q.x,m);j=Math.max(q.x,j);k=Math.min(q.y,k);d=Math.max(q.y,d)});if(d>0){d*=1.05}if(k<0){k*=1.05}}var h=a.Create("TH1I"),o=this.GetObject();h.fName=o.fName+"_hist";if(o.fTitle.indexOf(";")!==0){var p=o.fTitle.split(";");h.fTitle=p[0];if(p.length>1){h.fXaxis.fTitle=p[1]}if(p.length>2){h.fYaxis.fTitle=p[2]}}else{h.fTitle=o.fTitle}h.fXaxis.fXmin=m;h.fXaxis.fXmax=j;h.fYaxis.fXmin=k;h.fYaxis.fXmax=d;return h};this.ProcessTooltipFunc=function(d){var j=false;if((d===null)||(this.bins===null)){j=true}else{if((this.bins.length==0)||(d.x<this.bins[0].grx)||(d.x>this.bins[this.bins.length-1].grx)){j=true}}if(j){if(this.draw_g!==null){this.draw_g.select(".tooltip_bin").remove()}return null}var o=100000,m=-1,t;for(var l=0;l<this.bins.length;++l){t=this.bins[l];var s=Math.abs(t.grx-d.x);if(s<o){o=s;m=l}}t=this.bins[m];var k=this.draw_g.select(".tooltip_bin"),p=this.lineatt.width+3;if(k.empty()){k=this.draw_g.append("svg:circle").attr("class","tooltip_bin").style("pointer-events","none").attr("r",p).call(this.lineatt.func).call(this.fillatt.func)}var r={name:this.GetObject().fName,title:this.GetObject().fTitle,x:t.grx,y:t.gry,color1:this.lineatt.color,color2:this.fillatt.color,lines:[],exact:(Math.abs(t.grx-d.x)<p)&&(Math.abs(t.gry-d.y)<p)};r.changed=k.property("current_bin")!==m;r.menu=r.exact;r.menu_dist=Math.sqrt((t.grx-d.x)*(t.grx-d.x)+(t.gry-d.y)*(t.grx-d.x));if(r.changed){k.attr("cx",t.grx).attr("cy",t.gry).property("current_bin",m)}var h=this.GetTipName();if(h.length>0){r.lines.push(h)}var q=this.main_painter();if(q!==null){r.lines.push("x = "+q.AxisAsText("x",t.x)+" y = "+q.AxisAsText("y",t.y))}return r};this.Redraw=function(){var q=this.frame_width(),l=this.frame_height(),m=this.GetObject();this.RecreateDrawG(false,"main_layer");this.bins=this.CreateBins(false);var j=this;var o=this.main_painter();var d=this.GetTipName("\n");if(!this.lineatt){this.lineatt=a.Painter.createAttLine(m)}this.lineatt.used=false;if(!this.fillatt){this.fillatt=this.createAttFill(m,undefined,undefined,1)}this.fillatt.used=false;var k,s;for(k=0;k<this.bins.length;++k){s=this.bins[k];s.grx=o.grx(s.x);s.gry=o.gry(s.y)}if(this.bins.length>2){var p=l;if((o.hmin!==undefined)&&(o.hmin>=0)){p=Math.round(o.gry(0));if((p>l)||(p<0)){p=l}}var r=a.Painter.BuildSvgPath("bezier",this.bins,p,2);if(this.lineatt.color!="none"){this.draw_g.append("svg:path").attr("class","line").attr("d",r.path).style("fill","none").call(this.lineatt.func)}if(this.fillatt.color!="none"){this.draw_g.append("svg:path").attr("class","area").attr("d",r.path+r.close).style("stroke","none").call(this.fillatt.func)}}delete this.ProcessTooltip;if(a.gStyle.Tooltip>0){this.ProcessTooltip=this.ProcessTooltipFunc}};this.CanZoomIn=function(k,j,d){if(k!=="x"){return false}var o=this.GetObject();if(o.fSave.length>0){var m=o.fNpx;var l=o.fSave[m+1];var h=o.fSave[m+2];return Math.abs(l-h)/m<Math.abs(j-d)}return true};this.PerformDraw=function(){if(this.main_painter()===null){var d=this.CreateDummyHisto();a.Painter.drawHistogram1D(this.divid,d,"AXIS")}this.SetDivId(this.divid);this.Redraw();return this.DrawingReady()};this.SetDivId(g,-1);var e=new a.DrawOptions(c);this.nosave=e.check("NOSAVE");if(a.Math!==undefined){return this.PerformDraw()}a.AssertPrerequisites("math",this.PerformDraw.bind(this));return this};a.Painter.drawHStack=function(e,c,d){this.nostack=false;this.firstpainter=null;this.painters=[];this.SetDivId(e,-1);if(!c.fHists||(c.fHists.arr.length==0)){return this.DrawingReady()}this.Cleanup=function(){delete this.firstpainter;delete this.painters;a.TObjectPainter.prototype.Cleanup.call(this)};this.HasErrors=function(f){if(f.fSumw2&&(f.fSumw2.length>0)){for(var g=0;g<f.fSumw2.length;++g){if(f.fSumw2[g]>0){return true}}}return false};this.BuildStack=function(){var h=this.GetObject();if(!h.fHists){return false}var g=h.fHists.arr.length;if(g<=0){return false}var f=a.Create("TList");f.Add(a.clone(h.fHists.arr[0]));this.haserrors=this.HasErrors(h.fHists.arr[0]);for(var l=1;l<g;++l){var j=a.clone(h.fHists.arr[l]);var k=f.arr[l-1];if((j.fNbins!=k.fNbins)||(j.fXaxis.fXmin!=k.fXaxis.fXmin)||(j.fXaxis.fXmax!=k.fXaxis.fXmax)){a.console("When drawing THStack, cannot sum-up histograms "+j.fName+" and "+k.fName);delete j;f.Clear();delete f;return false}this.haserrors=this.haserrors||this.HasErrors(h.fHists.arr[l]);for(var m=0;m<j.fArray.length;++m){j.fArray[m]+=k.fArray[m]}f.Add(j)}h.fStack=f;return true};this.GetHistMinMax=function(q,t){var r={min:0,max:0},s=true,f=true;if(q.fMinimum!==-1111){r.min=q.fMinimum;s=false}if(q.fMaximum!==-1111){r.max=q.fMaximum;f=false}if(!s&&!f){return r}var l=1,h=q.fXaxis.fNbins,v=1,u=1,p=true;if(q.fXaxis.TestBit(a.EAxisBits.kAxisRange)){l=q.fXaxis.fFirst;h=q.fXaxis.fLast}if(q._typename.indexOf("TH2")===0){u=q.fYaxis.fNbins;if(q.fYaxis.TestBit(a.EAxisBits.kAxisRange)){v=q.fYaxis.fFirst;u=q.fYaxis.fLast}}for(var m=v;m<=u;++m){for(var o=l;o<=h;++o){var g=q.getBinContent(o,m),k=t?q.getBinError(q.getBin(o,m)):0;if(s&&(p||(g-k<r.min))){r.min=g-k}if(f&&(p||(g+k>r.max))){r.max=g+k}p=false}}return r};this.GetMinMax=function(j){var h={min:0,max:0},f=this.GetObject();if(this.nostack){for(var g=0;g<f.fHists.arr.length;++g){var k=this.GetHistMinMax(f.fHists.arr[g],j);if(g==0){h=k}else{if(k.min<h.min){h.min=k.min}if(k.max>h.max){h.max=k.max}}}if(f.fMaximum!=-1111){h.max=f.fMaximum}else{h.max*=1.05}if(f.fMinimum!=-1111){h.min=f.fMinimum}}else{h.min=this.GetHistMinMax(f.fStack.arr[0],j).min;h.max=this.GetHistMinMax(f.fStack.arr[f.fStack.arr.length-1],j).max*1.05}var l=this.root_pad();if(l&&l.fLogy){if(h.min<0){h.min=h.max*0.0001}}return h};this.DrawNextHisto=function(k,f,h){var o=this.GetObject(),m=o.fHistogram,q="",g=this.nostack?o.fHists:o.fStack,p=(g&&g.arr)?g.arr.length:0,l=0;if(k>=p){return this.DrawingReady()}if(k>=0){l=this.horder?k:p-k-1;m=g.arr[l];q=g.opt[l]||m.fOption||f;if(q.toUpperCase().indexOf(f)<0){q+=f}q+=" same"}else{q=(f||"")+" axis";if(h){q+=";minimum:"+h.min+";maximum:"+h.max}}if((l>0)&&!this.nostack){m.$baseh=g.arr[l-1]}var j=a.draw(this.divid,m,q);if(k<0){this.firstpainter=j}else{this.painters.push(j)}j.WhenReady(this.DrawNextHisto.bind(this,k+1,f))};this.drawStack=function(g){var k=this.root_pad(),v=this.GetObject(),p=v.fHists,y=p.arr.length,u=new a.DrawOptions(g),o=u.check("SAME");this.nostack=u.check("NOSTACK");g=u.opt;if(!this.nostack){this.nostack=!this.BuildStack()}if(!this.nostack&&this.haserrors&&!u.check("HIST")){g+=" E"}this.dolego=u.check("LEGO");this.horder=this.nostack||this.dolego;var l=this.GetMinMax(u.check("E"));var m=v.fHistogram;if(!m){var f=0,r=0,x=0,j=0;for(var q=0;q<y;++q){var t=p.arr[q];if(q==0||t.fXaxis.fXmin<f){f=t.fXaxis.fXmin}if(q==0||t.fXaxis.fXmax>r){r=t.fXaxis.fXmax}if(q==0||t.fYaxis.fXmin<x){x=t.fYaxis.fXmin}if(q==0||t.fYaxis.fXmax>j){j=t.fYaxis.fXmax}}var t=v.fHists.arr[0];v.fHistogram=m=a.CreateHistogram("TH1I",t.fXaxis.fNbins);m.fName=t.fName;m.fXaxis=a.clone(t.fXaxis);m.fYaxis=a.clone(t.fYaxis);m.fXaxis.fXmin=f;m.fXaxis.fXmax=r;m.fYaxis.fXmin=x;m.fYaxis.fXmax=j}m.fTitle=v.fTitle;if(k&&k.fLogy){if(l.max<=0){l.max=1}if(l.min<=0){l.min=0.0001*l.max}var s=1/(1+0.5*a.log10(l.max/l.min)),w=1+0.2*a.log10(l.max/l.min);l.min*=s;l.max*=w}this.DrawNextHisto(!o?-1:0,g,l);return this};this.UpdateObject=function(l){if(!this.MatchObjectType(l)){return false}var h=false;if(this.firstpainter){if(this.firstpainter.UpdateObject(l.fHistogram)){h=true}}var j=this.nostack?l.fHists.arr:l.fStack.arr,f=Math.min(j.length,this.painters.length);for(var g=0;g<f;++g){var k=j[this.horder?g:f-g-1];if(this.painters[g].UpdateObject(k)){h=true}}return h};this.drawStack(d);this.SetDivId(e);return this};a.TGraphPainter=function(c){a.TObjectPainter.call(this,c);this.ownhisto=false;this.bins=null;this.xmin=this.ymin=this.xmax=this.ymax=0;this.wheel_zoomy=true;this.is_bent=(c._typename=="TGraphBentErrors");this.has_errors=(c._typename=="TGraphErrors")||(c._typename=="TGraphAsymmErrors")||this.is_bent||c._typename.match(/^RooHist/)};a.TGraphPainter.prototype=Object.create(a.TObjectPainter.prototype);a.TGraphPainter.prototype.Redraw=function(){this.DrawBins()};a.TGraphPainter.prototype.DecodeOptions=function(e){var g=new a.DrawOptions(e);var c={Line:0,Curve:0,Rect:0,Mark:0,Bar:0,OutRange:0,EF:0,Fill:0,Errors:0,MainError:1,Ends:1,Axis:"AXIS"};var f=this.GetObject();if(this.has_errors){c.Errors=1}if(g.check("L")){c.Line=1}if(g.check("F")){c.Fill=1}if(g.check("A")){c.Axis="AXIS"}if(g.check("X+")){c.Axis+="X+"}if(g.check("Y+")){c.Axis+="Y+"}if(g.check("C")){c.Curve=1;if(!c.Fill){c.Line=1}}if(g.check("*")){c.Mark=103}if(g.check("P0")){c.Mark=104}if(g.check("P")){c.Mark=1}if(g.check("B")){c.Bar=1;c.Errors=0}if(g.check("Z")){c.Errors=1;c.Ends=0}if(g.check("||")){c.Errors=1;c.MainError=0;c.Ends=1}if(g.check("[]")){c.Errors=1;c.MainError=0;c.Ends=2}if(g.check("|>")){c.Errors=1;c.Ends=3}if(g.check(">")){c.Errors=1;c.Ends=4}if(g.check("0")){c.Mark=1;c.Errors=1;c.OutRange=1}if(g.check("1")){if(c.Bar==1){c.Bar=2}}if(g.check("2")){c.Rect=1;c.Line=0;c.Errors=0}if(g.check("3")){c.EF=1;c.Line=0;c.Errors=0}if(g.check("4")){c.EF=2;c.Line=0;c.Errors=0}if(g.check("5")){c.Rect=2;c.Line=0;c.Errors=0}if(g.check("X")){c.Errors=0}if((c.Mark==1)&&(f.fMarkerStyle==1)){c.Mark=101}if(c.Line+c.Fill+c.Mark+c.Bar+c.EF+c.Rect+c.Errors==0){if(g.empty()){c.Line=1}}if(f._typename=="TGraphErrors"){if(b.max(f.fEX)<1e-300&&b.max(f.fEY)<1e-300){c.Errors=0}}return c};a.TGraphPainter.prototype.CreateBins=function(){var c=this.GetObject();if(!c){return}var f,e=0,g=c.fNpoints;if((c._typename==="TCutG")&&(g>3)){g--}if(c._typename=="TGraphErrors"){e=1}else{if(c._typename=="TGraphAsymmErrors"||c._typename=="TGraphBentErrors"||c._typename.match(/^RooHist/)){e=2}}this.bins=[];for(f=0;f<g;++f){var d={x:c.fX[f],y:c.fY[f]};switch(e){case 1:d.exlow=d.exhigh=c.fEX[f];d.eylow=d.eyhigh=c.fEY[f];break;case 2:d.exlow=c.fEXlow[f];d.exhigh=c.fEXhigh[f];d.eylow=c.fEYlow[f];d.eyhigh=c.fEYhigh[f];break}this.bins.push(d);if(f===0){this.xmin=this.xmax=d.x;this.ymin=this.ymax=d.y}if(e>0){this.xmin=Math.min(this.xmin,d.x-d.exlow,d.x+d.exhigh);this.xmax=Math.max(this.xmax,d.x-d.exlow,d.x+d.exhigh);this.ymin=Math.min(this.ymin,d.y-d.eylow,d.y+d.eyhigh);this.ymax=Math.max(this.ymax,d.y-d.eylow,d.y+d.eyhigh)}else{this.xmin=Math.min(this.xmin,d.x);this.xmax=Math.max(this.xmax,d.x);this.ymin=Math.min(this.ymin,d.y);this.ymax=Math.max(this.ymax,d.y)}}};a.TGraphPainter.prototype.CreateHistogram=function(){var c=this.xmin,h=this.xmax,k=this.ymin,d=this.ymax;if(c>=h){h=c+1}if(k>=d){d=k+1}var p=(h-c)*0.1,o=(d-k)*0.1,m=c-p,e=h+p,j=k-o,f=d+o;if((m<0)&&(c>=0)){m=c*0.9}if((e>0)&&(h<=0)){e=0}var l=this.GetObject();if(l.fMinimum!=-1111){j=k=l.fMinimum}if(l.fMaximum!=-1111){f=d=l.fMaximum}if((j<0)&&(k>=0)){j=0.9*k}var g=a.CreateHistogram("TH1I",100);g.fName=l.fName+"_h";g.fTitle=l.fTitle;g.fXaxis.fXmin=m;g.fXaxis.fXmax=e;g.fYaxis.fXmin=j;g.fYaxis.fXmax=f;g.fMinimum=j;g.fMaximum=f;g.fBits=g.fBits|a.TH1StatusBits.kNoStats;return g};a.TGraphPainter.prototype.OptimizeBins=function(c){if((this.bins.length<30)&&!c){return this.bins}var g=null;if(typeof c=="function"){for(var f=0;f<this.bins.length;++f){if(c(this.bins[f],f)){if(g==null){g=(f==0)?[]:this.bins.slice(0,f)}}else{if(g!=null){g.push(this.bins[f])}}}}if(g==null){g=this.bins}if((g.length<5000)||(a.gStyle.OptimizeDraw==0)){return g}var e=Math.floor(g.length/5000);if(e<2){e=2}var d=[];for(var f=0;f<g.length;f+=e){d.push(g[f])}return d};a.TGraphPainter.prototype.TooltipText=function(h,g){var e=this.main_painter(),c=[];c.push(this.GetTipName());c.push("x = "+e.AxisAsText("x",h.x));c.push("y = "+e.AxisAsText("y",h.y));if(this.options.Errors&&(e.x_kind=="normal")&&("exlow" in h)&&((h.exlow!=0)||(h.exhigh!=0))){c.push("error x = -"+e.AxisAsText("x",h.exlow)+"/+"+e.AxisAsText("x",h.exhigh))}if((this.options.Errors||(this.options.EF>0))&&(e.y_kind=="normal")&&("eylow" in h)&&((h.eylow!=0)||(h.eyhigh!=0))){c.push("error y = -"+e.AxisAsText("y",h.eylow)+"/+"+e.AxisAsText("y",h.eyhigh))}if(g){return c}var f="";for(var j=0;j<c.length;++j){f+=((j>0?"\n":"")+c[j])}return f};a.TGraphPainter.prototype.DrawBins=function(){this.RecreateDrawG(false,"main_layer");var r=this,z=this.main_painter(),A=this.frame_width(),L=this.frame_height(),m=this.GetObject(),I=0;if(!this.lineatt){this.lineatt=a.Painter.createAttLine(m,undefined,true)}if(!this.fillatt){this.fillatt=this.createAttFill(m,undefined,undefined,1)}this.fillatt.used=false;if(this.fillatt){this.fillatt.used=false}this.draw_kind="none";this.marker_size=0;if(this.lineatt.excl_side!=0){I=this.lineatt.excl_side*this.lineatt.excl_width;if(this.lineatt.width>0){this.options.Line=1}}var B=null;if(this.options.EF){B=this.OptimizeBins();for(var G=0;G<B.length;++G){var C=B[G];C.grx=z.grx(C.x);C.gry=z.gry(C.y-C.eylow)}var k=a.Painter.BuildSvgPath(this.options.EF>1?"bezier":"line",B),e=[];for(var G=B.length-1;G>=0;--G){var C=B[G];C.gry=z.gry(C.y+C.eyhigh);e.push(C)}var g=a.Painter.BuildSvgPath(this.options.EF>1?"Lbezier":"Lline",e);this.draw_g.append("svg:path").attr("d",k.path+g.path+"Z").style("stroke","none").call(this.fillatt.func);this.draw_kind="lines"}if(this.options.Line==1||this.options.Fill==1||(I!==0)){var d="";if(m._typename=="TCutG"){this.options.Fill=1}if(this.options.Fill==1){d="Z";I=0}if(B===null){B=this.OptimizeBins()}for(var G=0;G<B.length;++G){var C=B[G];C.grx=z.grx(C.x);C.gry=z.gry(C.y)}var x="line";if(this.options.Curve===1){x="bezier"}else{if(I!==0){x+="calc"}}var D=a.Painter.BuildSvgPath(x,B);if(I!==0){var j=[];for(var G=B.length-1;G>=0;--G){var C=B[G];var H=Math.sqrt(C.dgrx*C.dgrx+C.dgry*C.dgry);C.grx+=I*C.dgry/H;C.gry-=I*C.dgrx/H;j.push(C)}var g=a.Painter.BuildSvgPath("L"+((this.options.Curve===1)?"bezier":"line"),j);this.draw_g.append("svg:path").attr("d",D.path+g.path+"Z").style("stroke","none").call(this.fillatt.func).style("opacity",0.75)}if(this.options.Line||this.options.Fill){var M=this.draw_g.append("svg:path").attr("d",D.path+d);if(this.options.Line){M.call(this.lineatt.func)}else{M.style("stroke","none")}if(this.options.Fill){M.call(this.fillatt.func)}else{M.style("fill","none")}}this.draw_kind="lines"}var F=null;if(this.options.Errors||this.options.Rect||this.options.Bar){B=this.OptimizeBins(function(P,O){var w=z.grx(P.x);if(!r.options.Bar&&((w<0)||(w>A))){return true}var h=z.gry(P.y);if(!r.options.Bar&&!r.options.OutRange&&((h<0)||(h>L))){return true}P.grx1=Math.round(w);P.gry1=Math.round(h);if(r.has_errors){P.grx0=Math.round(z.grx(P.x-P.exlow)-w);P.grx2=Math.round(z.grx(P.x+P.exhigh)-w);P.gry0=Math.round(z.gry(P.y-P.eylow)-h);P.gry2=Math.round(z.gry(P.y+P.eyhigh)-h);if(r.is_bent){P.grdx0=Math.round(z.gry(P.y+m.fEXlowd[O])-h);P.grdx2=Math.round(z.gry(P.y+m.fEXhighd[O])-h);P.grdy0=Math.round(z.grx(P.x+m.fEYlowd[O])-w);P.grdy2=Math.round(z.grx(P.x+m.fEYhighd[O])-w)}else{P.grdx0=P.grdx2=P.grdy0=P.grdy2=0}}return false});this.draw_kind="nodes";F=this.draw_g.selectAll(".grpoint").data(B).enter().append("svg:g").attr("class","grpoint").attr("transform",function(h){return"translate("+h.grx1+","+h.gry1+")"})}if(this.options.Bar){for(var J=1;J<B.length-1;++J){B[J].width=Math.max(2,(B[J+1].grx1-B[J-1].grx1)/2-2)}switch(B.length){case 0:break;case 1:B[0].width=A/4;break;case 2:B[0].width=B[1].width=(B[1].grx1-B[0].grx1)/2;break;default:B[0].width=B[1].width;B[B.length-1].width=B[B.length-2].width}var l=Math.round(z.gry(0));F.append("svg:rect").attr("x",function(h){return Math.round(-h.width/2)}).attr("y",function(h){h.bar=true;if(r.options.Bar!==1){return 0}return(h.gry1>l)?l-h.gry1:0}).attr("width",function(h){return Math.round(h.width)}).attr("height",function(h){if(r.options.Bar!==1){return L>h.gry1?L-h.gry1:0}return Math.abs(l-h.gry1)}).call(this.fillatt.func)}if(this.options.Rect){F.filter(function(h){return(h.exlow>0)&&(h.exhigh>0)&&(h.eylow>0)&&(h.eyhigh>0)}).append("svg:rect").attr("x",function(h){h.rect=true;return h.grx0}).attr("y",function(h){return h.gry2}).attr("width",function(h){return h.grx2-h.grx0}).attr("height",function(h){return h.gry0-h.gry2}).call(this.fillatt.func).call(this.options.Rect===2?this.lineatt.func:function(){})}this.error_size=0;if(this.options.Errors){var t=this.lineatt.width+a.gStyle.fEndErrorSize,u=0,E=this.options.Ends?"m0,"+t+"v-"+2*t:"",p=this.options.Ends?"m"+t+",0h-"+2*t:"",c=E,y=E,f=p,o=p,K=this.options.MainError?"M0,0L":"M";switch(this.options.Ends){case 2:u=Math.max(this.lineatt.width+1,Math.round(t*0.66));c="m"+u+","+t+"h-"+u+"v-"+2*t+"h"+u;y="m-"+u+","+t+"h"+u+"v-"+2*t+"h-"+u;f="m-"+t+","+u+"v-"+u+"h"+2*t+"v"+u;o="m-"+t+",-"+u+"v"+u+"h"+2*t+"v-"+u;break;case 3:t=Math.max(t,Math.round(m.fMarkerSize*8*0.66));u=Math.max(this.lineatt.width+1,Math.round(t*0.66));c="l"+u+","+t+"v-"+2*t+"l-"+u+","+t;y="l-"+u+","+t+"v-"+2*t+"l"+u+","+t;f="l-"+t+","+u+"h"+2*t+"l-"+t+",-"+u;o="l-"+t+",-"+u+"h"+2*t+"l-"+t+","+u;break;case 4:t=Math.max(t,Math.round(m.fMarkerSize*8*0.66));u=Math.max(this.lineatt.width+1,Math.round(t*0.66));c="l"+u+","+t+"m0,-"+2*t+"l-"+u+","+t;y="l-"+u+","+t+"m0,-"+2*t+"l"+u+","+t;f="l-"+t+","+u+"m"+2*t+",0l-"+t+",-"+u;o="l-"+t+",-"+u+"m"+2*t+",0l-"+t+","+u;break}this.error_size=t;t=Math.floor((this.lineatt.width-1)/2);F.filter(function(h){return(h.exlow>0)||(h.exhigh>0)||(h.eylow>0)||(h.eyhigh>0)}).append("svg:path").call(this.lineatt.func).style("fill","none").attr("d",function(h){h.error=true;return((h.exlow>0)?K+(h.grx0+t)+","+h.grdx0+c:"")+((h.exhigh>0)?K+(h.grx2-t)+","+h.grdx2+y:"")+((h.eylow>0)?K+h.grdy0+","+(h.gry0-t)+o:"")+((h.eyhigh>0)?K+h.grdy2+","+(h.gry2+t)+f:"")})}if(this.options.Mark){var v=Math.max(1,Math.round(this.bins.length/50000)),D="",G,N,s,q;if(!this.markeratt){this.markeratt=a.Painter.createAttMarker(m,this.options.Mark-100)}else{this.markeratt.Change(undefined,this.options.Mark-100)}this.marker_size=this.markeratt.size;this.markeratt.reset_pos();for(G=0;G<this.bins.length;G+=v){N=this.bins[G];s=z.grx(N.x);if((s>-this.marker_size)&&(s<A+this.marker_size)){q=z.gry(N.y);if((q>-this.marker_size)&&(q<L+this.marker_size)){D+=this.markeratt.create(s,q)}}}if(D.length>0){this.draw_g.append("svg:path").attr("d",D).call(this.markeratt.func);if((F===null)&&(this.draw_kind=="none")){this.draw_kind=(this.options.Mark==101)?"path":"mark"}}}};a.TGraphPainter.prototype.ProcessTooltip=function(c){if(!c){if(this.draw_g!==null){this.draw_g.select(".tooltip_bin").remove()}return null}if((this.draw_kind=="lines")||(this.draw_kind=="path")||(this.draw_kind=="mark")){return this.ProcessTooltipForPath(c)}if(this.draw_kind!="nodes"){return null}var e=this.frame_width(),p=this.frame_height(),h=this.main_painter(),m=this,o=null,l=10000000000,g=null;this.draw_g.selectAll(".grpoint").each(function(){var v=b.select(this).datum();if(v===undefined){return}var u=Math.pow(c.x-v.grx1,2);if(c.nproc===1){u+=Math.pow(c.y-v.gry1,2)}if(u>=l){return}var t=null;if(v.error||v.rect||v.marker){t={x1:Math.min(-m.error_size,v.grx0),x2:Math.max(m.error_size,v.grx2),y1:Math.min(-m.error_size,v.gry2),y2:Math.max(m.error_size,v.gry0)}}else{if(v.bar){t={x1:-v.width/2,x2:v.width/2,y1:0,y2:p-v.gry1};if(m.options.Bar===1){var s=h.gry(0);t.y1=(v.gry1>s)?s-v.gry1:0;t.y2=(v.gry1>s)?0:s-v.gry1}}else{t={x1:-5,x2:5,y1:-5,y2:5}}}var r=(c.x>=v.grx1+t.x1)&&(c.x<=v.grx1+t.x2);var q=(c.y>=v.gry1+t.y1)&&(c.y<=v.gry1+t.y2);if(r&&(q||(c.nproc>1))){l=u;o=this;g=t;g.exact=r&&q}});var f=this.draw_g.select(".tooltip_bin");if(o==null){f.remove();return null}var k=b.select(o).datum();var j={name:this.GetObject().fName,title:this.GetObject().fTitle,x:k.grx1,y:k.gry1,color1:this.lineatt.color,lines:this.TooltipText(k,true)};if(c.disabled){f.remove();return j}if(this.fillatt&&this.fillatt.used){j.color2=this.fillatt.color}if(g.exact){j.exact=true}j.menu=j.exact;j.menu_dist=3;if(f.empty()){f=this.draw_g.append("svg:rect").attr("class","tooltip_bin h1bin").style("pointer-events","none")}j.changed=f.property("current_bin")!==o;if(j.changed){f.attr("x",k.grx1+g.x1).attr("width",g.x2-g.x1).attr("y",k.gry1+g.y1).attr("height",g.y2-g.y1).style("opacity","0.3").property("current_bin",o)}return j};a.TGraphPainter.prototype.ProcessTooltipForPath=function(c){if(this.bins===null){return null}var d=(this.draw_kind=="lines"),k=(this.draw_kind=="mark"),s=null,u=10000000000,l=this.main_painter(),r,h,g,e,t;for(e=0;e<this.bins.length;++e){t=this.bins[e];h=l.grx(t.x);g=l.gry(t.y);r=(c.x-h)*(c.x-h)+(c.y-g)*(c.y-g);if(r<u){u=r;s=t}}if((u>100)&&d){s=null}var j=Math.max(this.lineatt.width+3,4);if(this.marker_size>0){j=Math.max(Math.round(this.marker_size*7),j)}if(s!==null){u=Math.sqrt(Math.pow(c.x-l.grx(s.x),2)+Math.pow(c.y-l.gry(s.y),2))}if(!d&&!k&&(u>j)){s=null}if(k&&(s!==null)){if((c.nproc==1)&&(u>j)){s=null}else{if((this.bins.length==1)&&(u>3*j)){s=null}}}var p=this.draw_g.select(".tooltip_bin");if(s===null){p.remove();return null}var o={name:this.GetObject().fName,title:this.GetObject().fTitle,x:l.grx(s.x),y:l.gry(s.y),color1:this.lineatt.color,lines:this.TooltipText(s,true)};if(c.disabled){p.remove();return o}if(this.fillatt&&this.fillatt.used){o.color2=this.fillatt.color}if(!d){o.color1=a.Painter.root_colors[this.GetObject().fMarkerColor];if(!o.color2){o.color2=o.color1}}if(p.empty()){p=this.draw_g.append("svg:g").attr("class","tooltip_bin")}var q,m;if(this.options.EF&&d){q=l.gry(s.y-s.eylow);m=l.gry(s.y+s.eyhigh)}else{q=m=l.gry(s.y)}o.exact=(Math.abs(c.x-o.x)<=j)&&((Math.abs(c.y-q)<=j)||(Math.abs(c.y-m)<=j));o.menu=o.exact;o.menu_dist=Math.sqrt((c.x-o.x)*(c.x-o.x)+Math.pow(Math.min(Math.abs(c.y-q),Math.abs(c.y-m)),2));o.changed=p.property("current_bin")!==s;if(o.changed){p.selectAll("*").remove();p.property("current_bin",s);if(k){p.append("svg:rect").attr("class","h1bin").style("pointer-events","none").style("opacity","0.3").attr("x",(o.x-j).toFixed(1)).attr("y",(o.y-j).toFixed(1)).attr("width",(2*j).toFixed(1)).attr("height",(2*j).toFixed(1))}else{p.append("svg:circle").attr("cy",q.toFixed(1));if(Math.abs(q-m)>1){p.append("svg:circle").attr("cy",m.toFixed(1))}var f=p.selectAll("circle").attr("r",j).attr("cx",o.x.toFixed(1));if(!d){f.style("stroke",o.color1=="black"?"green":"black").style("fill","none")}else{if(this.options.Line){f.call(this.lineatt.func)}else{f.style("stroke","black")}if(this.options.Fill){f.call(this.fillatt.func)}else{f.style("fill","none")}}}}return o};a.TGraphPainter.prototype.UpdateObject=function(d){if(!this.MatchObjectType(d)){return false}if(this.ownhisto){this.main_painter().UpdateObject(d.fHistogram)}var c=this.GetObject();c.fX=d.fX;c.fY=d.fY;c.fNpoints=d.fNpoints;this.CreateBins();return true};a.TGraphPainter.prototype.CanZoomIn=function(f,e,c){var d=this.GetObject();if((d===null)||(f!=="x")){return false}for(var g=0;g<d.fNpoints;++g){if((e<d.fX[g])&&(d.fX[g]<c)){return true}}return false};a.TGraphPainter.prototype.ButtonClick=function(d){if(d!=="ToggleZoom"){return false}var c=this.main_painter();if(c===null){return false}if((this.xmin===this.xmax)&&(this.ymin=this.ymax)){return false}c.Zoom(this.xmin,this.xmax,this.ymin,this.ymax);return true};a.TGraphPainter.prototype.DrawNextFunction=function(c,e){var d=this.GetObject();if(!d.fFunctions||(c>=d.fFunctions.arr.length)){return a.CallBack(e)}a.draw(this.divid,d.fFunctions.arr[c],d.fFunctions.opt[c],this.DrawNextFunction.bind(this,c+1,e))};a.Painter.drawGraph=function(e,d,c){a.extend(this,new a.TGraphPainter(d));this.options=this.DecodeOptions(c);this.SetDivId(e,-1);this.CreateBins();if(this.main_painter()==null){if(d.fHistogram==null){d.fHistogram=this.CreateHistogram()}a.Painter.drawHistogram1D(e,d.fHistogram,this.options.Axis);this.ownhisto=true}this.SetDivId(e);this.DrawBins();this.DrawNextFunction(0,this.DrawingReady.bind(this));return this};a.Painter.drawMultiGraph=function(e,d,c){this.firstpainter=null;this.autorange=false;this.painters=[];this.SetDivId(e,-1);this.Cleanup=function(){this.painters=[];a.TObjectPainter.prototype.Cleanup.call(this)};this.UpdateObject=function(m){if(!this.MatchObjectType(m)){return false}var o=this.GetObject(),g=m.fGraphs;o.fTitle=m.fTitle;var l=false;if(this.firstpainter){var f=m.fHistogram;if(this.autorange&&!f){f=this.ScanGraphsRange(g)}if(this.firstpainter.UpdateObject(f)){l=true}}for(var h=0;h<g.arr.length;++h){if(h<this.painters.length){if(this.painters[h].UpdateObject(g.arr[h])){l=true}}}if(m.fFunctions){for(var h=0;h<m.fFunctions.arr.length;++h){var k=m.fFunctions.arr[h];if(!k||!k._typename||!k.fName){continue}var j=this.FindPainterFor(null,k.fName,k._typename);if(j){j.UpdateObject(k)}}}return l};this.ComputeGraphRange=function(h,f){if(f.fNpoints==0){return}if(h.first){h.xmin=h.xmax=f.fX[0];h.ymin=h.ymax=f.fY[0];h.first=false}for(var g=0;g<f.fNpoints;++g){h.xmin=Math.min(h.xmin,f.fX[g]);h.xmax=Math.max(h.xmax,f.fX[g]);h.ymin=Math.min(h.ymin,f.fY[g]);h.ymax=Math.max(h.ymax,f.fY[g])}return h};this.padtoX=function(g,f){if(g.fLogx&&(f<50)){return Math.exp(2.302585092994*f)}return f};this.ScanGraphsRange=function(o,l,h){var j=this.GetObject(),k,p,u,t,s=0,g=0,r=false,q=false,f={xmin:0,xmax:0,ymin:0,ymax:0,first:true};if(h!=null){r=h.fLogx;q=h.fLogy;f.xmin=h.fUxmin;f.xmax=h.fUxmax;f.ymin=h.fUymin;f.ymax=h.fUymax;f.first=false}if(l!=null){p=l.fYaxis.fXmin;k=l.fYaxis.fXmax;if(h!=null){s=this.padtoX(h,f.xmin);g=this.padtoX(h,f.xmax)}}else{this.autorange=true;for(var m=0;m<o.arr.length;++m){this.ComputeGraphRange(f,o.arr[m])}if(f.xmin==f.xmax){f.xmax+=1}if(f.ymin==f.ymax){f.ymax+=1}u=0.05*(f.xmax-f.xmin);t=0.05*(f.ymax-f.ymin);s=f.xmin-u;g=f.xmax+u;if(q){if(f.ymin<=0){f.ymin=0.001*f.ymax}p=f.ymin/(1+0.5*a.log10(f.ymax/f.ymin));k=f.ymax*(1+0.2*a.log10(f.ymax/f.ymin))}else{p=f.ymin-t;k=f.ymax+t}if(p<0&&f.ymin>=0){p=0}if(k>0&&f.ymax<=0){k=0}}if(s<0&&f.xmin>=0){s=r?0.9*f.xmin:0}if(g>0&&f.xmax<=0){g=r?1.1*f.xmax:0}if(j.fMinimum!=-1111){f.ymin=p=j.fMinimum}if(j.fMaximum!=-1111){f.ymax=k=j.fMaximum}if(p<0&&f.ymin>=0&&q){p=0.9*f.ymin}if(k>0&&f.ymax<=0&&q){k=1.1*f.ymax}if(p<=0&&q){p=0.001*k}if(s<=0&&r){s=(g>1000)?1:0.001*g}if(!l){l=a.Create("TH1I");l.fTitle=j.fTitle;l.fXaxis.fXmin=s;l.fXaxis.fXmax=g}l.fYaxis.fXmin=p;l.fYaxis.fXmax=k;return l};this.DrawAxis=function(){var g=this.GetObject();var f=this.ScanGraphsRange(g.fGraphs,g.fHistogram,this.root_pad());this.firstpainter=a.Painter.drawHistogram1D(this.divid,f,"AXIS")};this.DrawNextFunction=function(f,h){var g=this.GetObject();if(!g.fFunctions||(f>=g.fFunctions.arr.length)){return a.CallBack(h)}a.draw(this.divid,g.fFunctions.arr[f],g.fFunctions.opt[f],this.DrawNextFunction.bind(this,f+1,h))};this.DrawNextGraph=function(j,h){var f=this.GetObject().fGraphs;if(j>=f.arr.length){return this.DrawNextFunction(0,this.DrawingReady.bind(this))}var g=f.opt[j];if((g==null)||(g=="")){g=h}var k=a.draw(this.divid,f.arr[j],g);this.painters.push(k);k.WhenReady(this.DrawNextGraph.bind(this,j+1,h))};if(c==null){c=""}c=c.toUpperCase().replace("3D","").replace("FB","");if((c.indexOf("A")>=0)||(this.main_painter()==null)){c=c.replace("A","");this.DrawAxis()}this.SetDivId(e);this.DrawNextGraph(0,c);return this};a.Painter.drawLegend=function(e,d,c){a.extend(this,new a.TPavePainter(d));this.SetDivId(e,2);this.AssignFinishPave();this.DrawLegendItems=function(u,E){var j=this.GetObject(),y=j.fPrimitives.arr.length,q=j.fNColumns,o=y;if(q<2){q=1}else{while((o-1)*q>=y){o--}}this.StartTextDrawing(j.fTextFont,E/(y*1.2));var N=a.Painter.root_colors[j.fTextColor],r=Math.round(u/q),x=Math.round(0.03*u/q),v=Math.round(0.03*E),t=(E-2*v)/o,k=false;for(var D=0;D<y;++D){var I=j.fPrimitives.arr[D],l=I.fOption.toLowerCase(),G=D%q,K=(D-G)/q,F=G*r,m=F+Math.round(j.fMargin*r),f=Math.round(v+K*t),M=Math.round(v+(K+0.5)*t),L=I,z=I,B=I,C=I.fObject,H=null,s=false;if((C!==null)&&(typeof C=="object")){if("fLineColor" in C){B=C}if("fFillColor" in C){L=C}if("fMarkerColor" in C){z=C}H=this.FindPainterFor(C)}if(l.indexOf("f")!=-1){var A=(H&&H.fillatt)?H.fillatt:this.createAttFill(L);this.draw_g.append("svg:rect").attr("x",F+x).attr("y",Math.round(f+t*0.1)).attr("width",m-2*x-F).attr("height",Math.round(t*0.8)).call(A.func);if(A.color!=="none"){s=true}}if(l.indexOf("l")!=-1){var J=(H&&H.lineatt)?H.lineatt:a.Painter.createAttLine(B);this.draw_g.append("svg:line").attr("x1",F+x).attr("y1",M).attr("x2",m-x).attr("y2",M).call(J.func);if(J.color!=="none"){s=true}}if(l.indexOf("e")!=-1&&(l.indexOf("l")==-1||l.indexOf("f")!=-1)){}if(l.indexOf("p")!=-1){var p=(H&&H.markeratt)?H.markeratt:a.Painter.createAttMarker(z);this.draw_g.append("svg:path").attr("d",p.create((F+m)/2,M)).call(p.func);if(p.color!=="none"){s=true}}if(!s&&H&&H.lineatt&&(H.lineatt.color!=="none")){this.draw_g.append("svg:rect").attr("x",F+x).attr("y",Math.round(f+t*0.1)).attr("width",m-2*x-F).attr("height",Math.round(t*0.8)).attr("fill","none").call(H.lineatt.func)}var g=m;if(l.length>0){k=true}else{if(!k){g=F+x}}this.DrawText("start",g,f,F+r-g-x,t,I.fLabel,N)}this.FinishTextDrawing(null,this.FinishPave)};this.PaveDrawFunc=this.DrawLegendItems;this.Redraw();return this};a.Painter.drawPaletteAxis=function(e,c,d){c.fBorderSize=1;c.fShadowColor=0;a.extend(this,new a.TPavePainter(c));this.SetDivId(e);this.z_handle=new a.TAxisPainter(c.fAxis,true);this.z_handle.SetDivId(e,-1);this.Cleanup=function(){if(this.z_handle){this.z_handle.Cleanup();delete this.z_handle}a.TObjectPainter.prototype.Cleanup.call(this)};this.DrawAxisPalette=function(u,N,q){var o=this,M=this.GetObject(),l=M.fAxis,y=(typeof q=="string")&&(q.indexOf("canmove")>0),B=(typeof q=="string")&&(q.indexOf("postpone")>0),v=l.fNdiv%100,h=parseInt(this.draw_g.attr("x")),g=parseInt(this.draw_g.attr("y")),F=this.pad_width(),E=this.pad_height(),m=l.fLabelOffset*F,t=this.main_painter(),O=0,Q=100,G=t.fContour;if(v<=0){v=8}l.fTickSize=0.6*u/F;if(G){O=Math.min(G[0],t.zmin);Q=Math.max(G[G.length-1],t.zmax)}else{if((t.gmaxbin!==undefined)&&(t.gminbin!==undefined)){O=t.gminbin;Q=t.gmaxbin}else{if((t.hmin!==undefined)&&(t.hmax!==undefined)){O=t.hmin;Q=t.hmax}}}var w=null,R="normal";if(this.root_pad().fLogz){w=b.scaleLog();R="log"}else{w=b.scaleLinear()}w.domain([O,Q]).range([N,0]);this.draw_g.selectAll("rect").style("fill","white");if(!G||B){this.draw_g.append("svg:rect").attr("x",0).attr("y",0).attr("width",u).attr("height",N).style("fill","white")}else{for(var K=0;K<G.length-1;++K){var C=w(G[K]),A=w(G[K+1]),p=t.getValueColor((G[K]+G[K+1])/2);var D=this.draw_g.append("svg:rect").attr("x",0).attr("y",A.toFixed(1)).attr("width",u).attr("height",(C-A).toFixed(1)).style("fill",p).style("stroke",p).property("fill0",p).property("fill1",b.rgb(p).darker(0.5).toString());if(a.gStyle.Tooltip>0){D.on("mouseover",function(){b.select(this).transition().duration(100).style("fill",b.select(this).property("fill1"))}).on("mouseout",function(){b.select(this).transition().duration(100).style("fill",b.select(this).property("fill0"))}).append("svg:title").text(G[K].toFixed(2)+" - "+G[K+1].toFixed(2))}if(a.gStyle.Zooming){D.on("dblclick",function(){o.main_painter().Unzoom("z")})}}}this.z_handle.SetAxisConfig("zaxis",R,w,O,Q,O,Q);this.z_handle.DrawAxis(true,this.draw_g,u,N,"translate("+u+", 0)");if(y&&("getBoundingClientRect" in this.draw_g.node())){var k=this.draw_g.node().getBoundingClientRect();var L=(h+parseInt(k.width))-Math.round(0.995*F)+3;if(L>0){this.draw_g.attr("x",h-L).attr("y",g).attr("transform","translate("+(h-L)+", "+g+")");M.fX1NDC-=L/F;M.fX2NDC-=L/F}}if(!a.gStyle.Zooming){return}var s=null,P=false,I=0,H=0,f=null;function x(){if(!P){return}b.event.preventDefault();var r=b.mouse(s);if(r[1]<I){I=r[1]}else{H=r[1]}f.attr("y",I).attr("height",Math.abs(H-I))}function j(){if(!P){return}b.event.preventDefault();b.select(window).on("mousemove.colzoomRect",null).on("mouseup.colzoomRect",null);f.remove();f=null;P=false;var r=Math.min(w.invert(I),w.invert(H)),z=Math.max(w.invert(I),w.invert(H));o.main_painter().Zoom("z",r,z)}function J(){if(P){return}P=true;b.event.preventDefault();s=this;var r=b.mouse(s);I=H=r[1];f=o.draw_g.append("svg:rect").attr("class","zoom").attr("id","colzoomRect").attr("x","0").attr("width",u).attr("y",I).attr("height",5);b.select(window).on("mousemove.colzoomRect",x).on("mouseup.colzoomRect",j,true);b.event.stopPropagation()}this.draw_g.select(".axis_zoom").on("mousedown",J).on("dblclick",function(){o.main_painter().Unzoom("z")})};this.ShowContextMenu=function(f){this.main_painter().ShowContextMenu("z",f,this.GetObject().fAxis)};this.PaveDrawFunc=this.DrawAxisPalette;this.UseContextMenu=true;this.DrawPave(d);return this.DrawingReady()};a.THistPainter.prototype.CreateContour=function(j,d,g,f){if(j<1){j=a.gStyle.fNumberContours}this.fContour=[];this.colzmin=d;this.colzmax=g;if(this.root_pad().fLogz){if(this.colzmax<=0){this.colzmax=1}if(this.colzmin<=0){if((f===undefined)||(f<=0)){this.colzmin=0.0001*this.colzmax}else{this.colzmin=((f<3)||(f>100))?0.3*f:1}}if(this.colzmin>=this.colzmax){this.colzmin=0.0001*this.colzmax}var e=Math.log(this.colzmin)/Math.log(10),h=Math.log(this.colzmax)/Math.log(10),c=(h-e)/j;this.fContour.push(this.colzmin);for(var k=1;k<j;k++){this.fContour.push(Math.exp((e+c*k)*Math.log(10)))}this.fContour.push(this.colzmax);this.fCustomContour=true}else{if((this.colzmin===this.colzmax)&&(this.colzmin!==0)){this.colzmax+=0.01*Math.abs(this.colzmax);this.colzmin-=0.01*Math.abs(this.colzmin)}var c=(this.colzmax-this.colzmin)/j;for(var k=0;k<=j;k++){this.fContour.push(this.colzmin+c*k)}}if(this.Dimension()<3){this.zmin=this.colzmin;this.zmax=this.colzmax}return this.fContour};a.THistPainter.prototype.GetContour=function(){if(this.fContour){return this.fContour}var c=this.main_painter();if((c!==this)&&c.fContour){this.fContour=c.fContour;this.fCustomContour=c.fCustomContour;this.colzmin=c.colzmin;this.colzmax=c.colzmax;return this.fContour}var e=this.GetObject(),h=a.gStyle.fNumberContours,d=this.minbin,g=this.maxbin,f=this.minposbin;if(d===g){d=this.gminbin;g=this.gmaxbin;f=this.gminposbin}if(e.fContour){h=e.fContour.length}if((this.options.minimum!==-1111)&&(this.options.maximum!=-1111)){d=this.options.minimum;g=this.options.maximum}if(this.zoom_zmin!=this.zoom_zmax){d=this.zoom_zmin;g=this.zoom_zmax}if(e.fContour&&(e.fContour.length>1)&&e.TestBit(a.TH1StatusBits.kUserContour)){this.fContour=a.clone(e.fContour);this.fCustomContour=true;this.colzmin=d;this.colzmax=g;if(g>this.fContour[this.fContour.length-1]){this.fContour.push(g)}if(this.Dimension()<3){this.zmin=this.colzmin;this.zmax=this.colzmax}return this.fContour}this.fCustomContour=false;return this.CreateContour(h,d,g,f)};a.THistPainter.prototype.getContourIndex=function(d){var g=this.GetContour();if(this.fCustomContour){var c=0,f=g.length-1,e;if(d<g[0]){return -1}if(d>=g[f]){return f}while(c<f-1){e=Math.round((c+f)/2);if(g[e]>d){f=e}else{c=e}}return c}if(d<this.colzmin){return(this.options.Color===11)?0:-1}if(d===this.colzmin){return((this.colzmin!=0)||(this.options.Color===11)||this.IsTH2Poly())?0:-1}return Math.floor(0.01+(d-this.colzmin)*(g.length-1)/(this.colzmax-this.colzmin))};a.THistPainter.prototype.getIndexColor=function(d,g){if(d<0){return null}var f=this.GetContour();var c=this.GetPalette();var e=Math.floor((d+0.99)*c.length/(f.length-1));if(e>c.length-1){e=c.length-1}return g?e:c[e]};a.THistPainter.prototype.getValueColor=function(d,g){var e=this.getContourIndex(d);if(e<0){return null}var c=this.GetPalette();var f=Math.floor((e+0.99)*c.length/(this.fContour.length-1));if(f>c.length-1){f=c.length-1}return g?f:c[f]};a.THistPainter.prototype.GetPalette=function(c){if(!this.fPalette||c){this.fPalette=a.Painter.GetColorPalette(this.options.Palette)}return this.fPalette};a.THistPainter.prototype.FillPaletteMenu=function(e){var d=this.options.Palette;if((d===null)||(d===0)){d=a.gStyle.Palette}function f(g){this.options.Palette=parseInt(g);this.GetPalette(true);this.Redraw()}function c(j,g,h){e.addchk((j===d)||h,"<nobr>"+g+"</nobr>",j,f)}e.add("sub:Palette");c(50,"ROOT 5",(d>=10)&&(d<51));c(51,"Deep Sea");c(52,"Grayscale",(d>0)&&(d<10));c(53,"Dark body radiator");c(54,"Two-color hue");c(55,"Rainbow");c(56,"Inverted dark body radiator");c(57,"Bird",(d>112));c(58,"Cubehelix");c(59,"Green Red Violet");c(60,"Blue Red Yellow");c(61,"Ocean");c(62,"Color Printable On Grey");c(63,"Alpine");c(64,"Aquamarine");c(65,"Army");c(66,"Atlantic");e.add("endsub:")};a.THistPainter.prototype.DrawColorPalette=function(g,k,j){if(!this.is_main_painter()){return null}var d=this.FindFunction("TPaletteAxis"),f=this.FindPainterFor(d);if(this._can_move_colz){j=true;delete this._can_move_colz}if(!f&&!d){f=this.FindPainterFor(undefined,undefined,"TPaletteAxis");if(f){d=f.GetObject();this.AddFunction(d,true)}}if(!g){if(f){f.Enabled=false;f.RemoveDrawG()}return null}if(d===null){d=a.Create("TPave");a.extend(d,{_typename:"TPaletteAxis",fName:"TPave",fH:null,fAxis:null,fX1NDC:0.91,fX2NDC:0.95,fY1NDC:0.1,fY2NDC:0.9,fInit:1});d.fAxis=a.Create("TGaxis");a.extend(d.fAxis,{fTitle:this.GetObject().fZaxis.fTitle,fLineColor:1,fLineSyle:1,fLineWidth:1,fTextAngle:0,fTextSize:0.04,fTextAlign:11,fTextColor:1,fTextFont:42});this.AddFunction(d,true);j=true}var e=this.frame_painter();if(j){d.fX2NDC=e.fX2NDC+0.01+(d.fX2NDC-d.fX1NDC);d.fX1NDC=e.fX2NDC+0.01;d.fY1NDC=e.fY1NDC;d.fY2NDC=e.fY2NDC}var c="";if(k){c+=";postpone"}if(j&&!this.do_redraw_palette){c+=";canmove"}if(f===null){var h=this.CurrentPadName(this.pad_name);f=a.draw(this.divid,d,c);this.CurrentPadName(h)}else{f.Enabled=true;f.DrawPave(c)}f.Redraw=function(){};if((d.fX1NDC-0.005<e.fX2NDC)&&!this.do_redraw_palette&&j){this.do_redraw_palette=true;e.fX2NDC=d.fX1NDC-0.01;e.Redraw();if(!k){this.Redraw()}delete this.do_redraw_palette}return f};a.THistPainter.prototype.ToggleColz=function(){if(this.options.Zscale>0){this.options.Zscale=0}else{this.options.Zscale=1}this.DrawColorPalette(this.options.Zscale>0,false,true)};a.TH2Painter=function(c){a.THistPainter.call(this,c);this.fContour=null;this.fCustomContour=false;this.fPalette=null};a.TH2Painter.prototype=Object.create(a.THistPainter.prototype);a.TH2Painter.prototype.Cleanup=function(){delete this.fCustomContour;delete this.tt_handle;a.THistPainter.prototype.Cleanup.call(this)};a.TH2Painter.prototype.FillHistContextMenu=function(d){d.add("Auto zoom-in",this.AutoZoom);var c=a.getDrawSettings("ROOT."+this.GetObject()._typename,"nosame");d.addDrawMenu("Draw with",c.opts,function(e){if(e==="inspect"){return a.draw(this.divid,this.GetObject(),e)}this.options=this.DecodeOptions(e);this.RedrawPad()});if(this.options.Color>0){this.FillPaletteMenu(d)}};a.TH2Painter.prototype.ButtonClick=function(c){if(a.THistPainter.prototype.ButtonClick.call(this,c)){return true}if(this!==this.main_painter()){return false}switch(c){case"ToggleColor":this.ToggleColor();break;case"ToggleColorZ":if(this.options.Lego===12||this.options.Lego===14||this.options.Color>0||this.options.Contour>0||this.options.Surf===11||this.options.Surf===12){this.ToggleColz()}break;case"Toggle3D":if(this.options.Surf>0){this.options.Surf=-this.options.Surf}else{if(this.options.Lego>0){this.options.Lego=0}else{if(this.options.Surf<0){this.options.Surf=-this.options.Surf}else{if((this.nbinsx>=50)||(this.nbinsy>=50)){this.options.Lego=(this.options.Color>0)?14:13}else{this.options.Lego=(this.options.Color>0)?12:1}this.options.Zero=0}}}this.RedrawPad();break;default:return false}return true};a.TH2Painter.prototype.FillToolbar=function(){a.THistPainter.prototype.FillToolbar.call(this);var c=this.pad_painter(true);if(c===null){return}if(!this.IsTH2Poly()){c.AddButton(a.ToolbarIcons.th2color,"Toggle color","ToggleColor")}c.AddButton(a.ToolbarIcons.th2colorz,"Toggle color palette","ToggleColorZ");c.AddButton(a.ToolbarIcons.th2draw3d,"Toggle 3D mode","Toggle3D")};a.TH2Painter.prototype.ToggleColor=function(){var c=true;if(this.options.Lego>0){this.options.Lego=0;c=false}else{if(this.options.Surf>0){this.options.Surf=-this.options.Surf;c=false}}if(this.options.Color==0){this.options.Color=("LastColor" in this.options)?this.options.LastColor:1}else{if(c){this.options.LastColor=this.options.Color;this.options.Color=0}}this._can_move_colz=true;this.Redraw()};a.TH2Painter.prototype.AutoZoom=function(){if(this.IsTH2Poly()){return}var k=this.GetSelectIndex("x","left",-1),h=this.GetSelectIndex("x","right",1),v=this.GetSelectIndex("y","left",-1),u=this.GetSelectIndex("y","right",1),s,o,p=this.GetObject();if((k==h)||(v==u)){return}var m=p.getBinContent(k+1,v+1);for(s=k;s<h;++s){for(o=v;o<u;++o){m=Math.min(m,p.getBinContent(s+1,o+1))}}if(m>0){return}var f=h,e=k,c=u,l=v;for(s=k;s<h;++s){for(o=v;o<u;++o){if(p.getBinContent(s+1,o+1)>m){if(s<f){f=s}if(s>=e){e=s+1}if(o<c){c=o}if(o>=l){l=o+1}}}}var d,r,t,g,q=false;if((f===e-1)&&(f>k+1)&&(e<h-1)){f--;e++}if((c===l-1)&&(c>v+1)&&(l<u-1)){c--;l++}if((f>k||e<h)&&(f<e-1)){d=this.GetBinX(f);r=this.GetBinX(e);q=true}if((c>v||l<u)&&(c<l-1)){t=this.GetBinY(c);g=this.GetBinY(l);q=true}if(q){this.Zoom(d,r,t,g)}};a.TH2Painter.prototype.ScanContent=function(g){if(g&&this.nbinsx&&this.nbinsy){return}var f,e,d=this.GetObject();this.nbinsx=d.fXaxis.fNbins;this.nbinsy=d.fYaxis.fNbins;this.CreateAxisFuncs(true);if(this.IsTH2Poly()){this.gminposbin=null;this.gminbin=this.gmaxbin=0;for(var k=0,c=d.fBins.arr.length;k<c;++k){var h=d.fBins.arr[k].fContent;if(k===0){this.gminbin=this.gmaxbin=h}if(h<this.gminbin){this.gminbin=h}else{if(h>this.gmaxbin){this.gmaxbin=h}}if(h>0){if((this.gminposbin===null)||(this.gminposbin>h)){this.gminposbin=h}}}}else{this.gminbin=this.gmaxbin=d.getBinContent(1,1);this.gminposbin=null;for(f=0;f<this.nbinsx;++f){for(e=0;e<this.nbinsy;++e){var h=d.getBinContent(f+1,e+1);if(h<this.gminbin){this.gminbin=h}else{if(h>this.gmaxbin){this.gmaxbin=h}}if(h>0){if((this.gminposbin===null)||(this.gminposbin>h)){this.gminposbin=h}}}}}if(this.gminposbin===null){this.gminposbin=this.gmaxbin*0.0001}this.draw_content=this.gmaxbin>0};a.TH2Painter.prototype.CountStat=function(l){var o=this.GetObject(),f=0,j=0,x=0,h=0,w=0,C=0,d,z,g,s,E,G={entries:0,integral:0,meanx:0,meany:0,rmsx:0,rmsy:0,matrix:[0,0,0,0,0,0,0,0,0],xmax:0,ymax:0,wmax:null};if(this.IsTH2Poly()){var B=o.fBins.arr.length,y,r,v,t,m,q,c,k=this.main_painter();for(y=0;y<B;++y){r=o.fBins.arr[y];d=1;z=1;if(r.fXmin>k.scale_xmax){d=2}else{if(r.fXmax<k.scale_xmin){d=0}}if(r.fYmin>k.scale_ymax){z=2}else{if(r.fYmax<k.scale_ymin){z=0}}g=s=c=0;t=r.fPoly;q=1;if(t._typename==="TMultiGraph"){q=r.fPoly.fGraphs.arr.length;t=null}for(m=0;m<q;++m){if(!t||(m>0)){t=r.fPoly.fGraphs.arr[m]}for(v=0;v<t.fNpoints;++v){++c;g+=t.fX[v];s+=t.fY[v]}}if(c>1){g=g/c;s=s/c}E=r.fContent;G.entries+=E;G.matrix[z*3+d]+=E;if((d!=1)||(z!=1)){continue}if((l!=null)&&!l(g,s)){continue}if((G.wmax==null)||(E>G.wmax)){G.wmax=E;G.xmax=g;G.ymax=s}f+=E;j+=g*E;x+=s*E;h+=g*g*E;w+=s*s*E;C+=g*s*E}}else{var e=this.GetSelectIndex("x","left"),u=this.GetSelectIndex("x","right"),D=this.GetSelectIndex("y","left"),A=this.GetSelectIndex("y","right"),p,F;for(p=0;p<=this.nbinsx+1;++p){d=(p<=e)?0:(p>u?2:1);g=this.GetBinX(p-0.5);for(F=0;F<=this.nbinsy+1;++F){z=(F<=D)?0:(F>A?2:1);s=this.GetBinY(F-0.5);E=o.getBinContent(p,F);G.entries+=E;G.matrix[z*3+d]+=E;if((d!=1)||(z!=1)){continue}if((l!=null)&&!l(g,s)){continue}if((G.wmax==null)||(E>G.wmax)){G.wmax=E;G.xmax=g;G.ymax=s}f+=E;j+=g*E;x+=s*E;h+=g*g*E;w+=s*s*E;C+=g*s*E}}}if(!this.IsAxisZoomed("x")&&!this.IsAxisZoomed("y")&&(o.fTsumw>0)){f=o.fTsumw;j=o.fTsumwx;h=o.fTsumwx2;x=o.fTsumwy;w=o.fTsumwy2;C=o.fTsumwxy}if(f>0){G.meanx=j/f;G.meany=x/f;G.rmsx=Math.sqrt(Math.abs(h/f-G.meanx*G.meanx));G.rmsy=Math.sqrt(Math.abs(w/f-G.meany*G.meany))}if(G.wmax===null){G.wmax=0}G.integral=f;if(o.fEntries>1){G.entries=o.fEntries}return G};a.TH2Painter.prototype.FillStatistic=function(j,l,v){if(this.GetObject()===null){return false}var k=j.GetObject(),h=this.CountStat(),q=Math.floor(l%10),t=Math.floor(l/10)%10,p=Math.floor(l/100)%10,s=Math.floor(l/1000)%10,c=Math.floor(l/10000)%10,d=Math.floor(l/100000)%10,f=Math.floor(l/1000000)%10,o=Math.floor(l/10000000)%10,g=Math.floor(l/100000000)%10;if(q>0){k.AddText(this.GetObject().fName)}if(t>0){k.AddText("Entries = "+j.Format(h.entries,"entries"))}if(p>0){k.AddText("Mean x = "+j.Format(h.meanx));k.AddText("Mean y = "+j.Format(h.meany))}if(s>0){k.AddText("Std Dev x = "+j.Format(h.rmsx));k.AddText("Std Dev y = "+j.Format(h.rmsy))}if(f>0){k.AddText("Integral = "+j.Format(h.matrix[4],"entries"))}if(o>0){k.AddText("Skewness x = <undef>");k.AddText("Skewness y = <undef>")}if(g>0){k.AddText("Kurt = <undef>")}if((c>0)||(d>0)){var e=h.matrix;k.AddText(""+e[6].toFixed(0)+" | "+e[7].toFixed(0)+" | "+e[7].toFixed(0));k.AddText(""+e[3].toFixed(0)+" | "+e[4].toFixed(0)+" | "+e[5].toFixed(0));k.AddText(""+e[0].toFixed(0)+" | "+e[1].toFixed(0)+" | "+e[2].toFixed(0))}var r=k.fLines.arr.length,u=r*a.gStyle.StatFontSize;if(u<=0||3==(a.gStyle.StatFont%10)){u=0.25*r*a.gStyle.StatH;k.fY1NDC=0.93-u;k.fY2NDC=0.93}return true};a.TH2Painter.prototype.PrepareColorDraw=function(l){if(!l){l={rounding:true,extra:0,middle:0}}if(l.extra===undefined){l.extra=0}if(l.middle===undefined){l.middle=0}var f=this.GetObject(),c=this.root_pad(),h=this.main_painter(),d=this.Dimension(),g,e,p,o,m,q,k={i1:this.GetSelectIndex("x","left",0-l.extra),i2:this.GetSelectIndex("x","right",1+l.extra),j1:(d===1)?0:this.GetSelectIndex("y","left",0-l.extra),j2:(d===1)?1:this.GetSelectIndex("y","right",1+l.extra),min:0,max:0,sumz:0};k.grx=new Float32Array(k.i2+1);k.gry=new Float32Array(k.j2+1);if(l.pixel_density){l.rounding=true}for(g=k.i1;g<=k.i2;++g){p=this.GetBinX(g+l.middle);if(h.logx&&(p<=0)){k.i1=g+1;continue}k.grx[g]=h.grx(p);if(l.rounding){k.grx[g]=Math.round(k.grx[g])}if(l.use3d){if(k.grx[g]<-h.size_xy3d){k.i1=g;k.grx[g]=-h.size_xy3d}if(k.grx[g]>h.size_xy3d){k.i2=g;k.grx[g]=h.size_xy3d}}}if(d===1){k.gry[0]=h.gry(0);k.gry[1]=h.gry(1)}else{for(e=k.j1;e<=k.j2;++e){o=this.GetBinY(e+l.middle);if(h.logy&&(o<=0)){k.j1=e+1;continue}k.gry[e]=h.gry(o);if(l.rounding){k.gry[e]=Math.round(k.gry[e])}if(l.use3d){if(k.gry[e]<-h.size_xy3d){k.j1=e;k.gry[e]=-h.size_xy3d}if(k.gry[e]>h.size_xy3d){k.j2=e;k.gry[e]=h.size_xy3d}}}}m=f.getBinContent(k.i1+1,k.j1+1);this.maxbin=this.minbin=this.minposbin=null;for(g=k.i1;g<k.i2;++g){for(e=k.j1;e<k.j2;++e){m=f.getBinContent(g+1,e+1);k.sumz+=m;if(l.pixel_density){q=(k.grx[g+1]-k.grx[g])*(k.gry[e]-k.gry[e+1]);if(q<=0){continue}k.max=Math.max(k.max,m);if((m>0)&&((m<k.min)||(k.min===0))){k.min=m}m=m/q}if(this.maxbin===null){this.maxbin=this.minbin=m}else{this.maxbin=Math.max(this.maxbin,m);this.minbin=Math.min(this.minbin,m)}if(m>0){if((this.minposbin===null)||(m<this.minposbin)){this.minposbin=m}}}}this.fContour=null;this.fCustomContour=false;return k};a.TH2Painter.prototype.DrawBinsColor=function(p,g){var e=this.GetObject(),k=this.PrepareColorDraw(),c=[],o=[],m=[],r,s,q,f,d,l;for(f=k.i1;f<k.i2;++f){for(d=k.j1;d<k.j2;++d){l=e.getBinContent(f+1,d+1);r=this.getValueColor(l,true);if(l===0){if(this.options.Color===11){continue}if((r===null)&&this._show_empty_bins){r=0}}if(r===null){continue}s="M"+k.grx[f]+","+k.gry[d+1];if(c[r]===undefined){c[r]=s}else{q="m"+(k.grx[f]-o[r])+","+(k.gry[d+1]-m[r]);c[r]+=(q.length<s.length)?q:s}o[r]=k.grx[f];m[r]=k.gry[d+1];c[r]+="v"+(k.gry[d]-k.gry[d+1])+"h"+(k.grx[f+1]-k.grx[f])+"v"+(k.gry[d+1]-k.gry[d])+"z"}}for(r=0;r<c.length;++r){if(c[r]!==undefined){this.draw_g.append("svg:path").attr("palette-index",r).attr("fill",this.fPalette[r]).attr("d",c[r])}}return k};a.TH2Painter.prototype.BuildContour=function(E,D,ab,u){var w=this.GetObject(),K=404,e=400,O=new Float32Array(2*K),c=new Float32Array(2*K),t=new Int32Array(2*K),P=0,Z,L,S=[],ad,B=0,U=new Float32Array(4),T=new Float32Array(4),g=new Float32Array(4),H=new Int32Array(4),ac,aa,Y,W,X,G,d,V,I,v,s,G,f;function o(j){for(var k=0;k<D.length;++k){if(j<D[k]){return k-1}}return D.length-1}function h(af,ao,ar,m,ae,an,aq,k){var ap=(ar===aq),j=ap?(k-m):(aq-ar),am=ao+1,y=ae-af,ag=P-1,aj=K/2-3+P,x=0,al,ai,ah,ak;while(am<=an&&ag<=aj){ak=D[am];ah=ak-af;ai=ah/y;al=j*ai;if(ap){O[ag]=ar;c[ag]=m+al}else{O[ag]=ar+al;c[ag]=m}t[ag]=am;x++;ag+=2;am++}return x}for(aa=E.j1;aa<E.j2-1;++aa){T[1]=T[0]=(E.gry[aa]+E.gry[aa+1])/2;T[3]=T[2]=(E.gry[aa+1]+E.gry[aa+2])/2;for(ac=E.i1;ac<E.i2-1;++ac){g[0]=w.getBinContent(ac+1,aa+1);g[1]=w.getBinContent(ac+2,aa+1);g[2]=w.getBinContent(ac+2,aa+2);g[3]=w.getBinContent(ac+1,aa+2);for(Y=0;Y<4;Y++){H[Y]=o(g[Y])}if((H[0]!==H[1])||(H[1]!==H[2])||(H[2]!==H[3])||(H[3]!==H[0])){U[3]=U[0]=(E.grx[ac]+E.grx[ac+1])/2;U[2]=U[1]=(E.grx[ac+1]+E.grx[ac+2])/2;if(g[0]<=g[1]){W=0}else{W=1}if(g[2]<=g[3]){X=2}else{X=3}if(g[W]>g[X]){W=X}W++;P=1;for(G=1;G<=4;G++){X=W%4+1;d=h(g[W-1],H[W-1],U[W-1],T[W-1],g[X-1],H[X-1],U[X-1],T[X-1]);P+=2*d;W=X}if(g[0]<=g[1]){W=0}else{W=1}if(g[2]<=g[3]){X=2}else{X=3}if(g[W]>g[X]){W=X}W++;P=2;for(G=1;G<=4;G++){if(W==1){X=4}else{X=W-1}d=h(g[W-1],H[W-1],U[W-1],T[W-1],g[X-1],H[X-1],U[X-1],T[X-1]);P+=2*d;W=X}V=0;for(G=1;G<=P-5;G+=2){while(t[G-1]!=t[G]){I=O[G];v=c[G];s=t[G];for(f=G;f<=P-5;f+=2){O[f]=O[f+2];c[f]=c[f+2];t[f]=t[f+2]}O[P-3]=I;c[P-3]=v;t[P-3]=s;if(V>e){break}V++}}if(V>e){continue}for(G=1;G<=P-2;G+=2){Z=t[G-1];if((Z>=0)&&(Z<D.length)){L=S[Z];if(!L){L=S[Z]=a.CreateTPolyLine(K*4,true)}ad=L.fLastPoint;if(ad<L.fN-2){L.fX[ad+1]=Math.round(O[G-1]);L.fY[ad+1]=Math.round(c[G-1]);L.fX[ad+2]=Math.round(O[G]);L.fY[ad+2]=Math.round(c[G]);L.fLastPoint=ad+2;B=Math.max(B,L.fLastPoint+1)}else{}}}}}}var M=new Int32Array(D.length),r=0;for(Z=0;Z<D.length;Z++){if(D[Z]>=0){r=Z;break}}Y=0;for(Z=r-1;Z>=0;Z--){M[Y]=Z;Y++}for(Z=r;Z<D.length;Z++){M[Y]=Z;Y++}var Q=new Int32Array(2*B),A=new Int32Array(2*B);for(Y=0;Y<D.length;++Y){Z=M[Y];L=S[Z];if(!L){continue}var F=Math.floor((Z+0.99)*ab.length/(D.length-1));if(F>ab.length-1){F=ab.length-1}var J=L.fX,q=L.fY,ad=L.fLastPoint+1,R=0,z,C,l=0,N=0,p;while(true){z=B;C=z+1;Q[z]=J[R];A[z]=q[R];Q[C]=J[R+1];A[C]=q[R+1];J[R]=J[R+1]=l;q[R]=q[R+1]=N;while(true){p=0;for(ac=2;ac<ad;ac+=2){if(J[ac]===Q[C]&&q[ac]===A[C]){C++;Q[C]=J[ac+1];A[C]=q[ac+1];J[ac]=J[ac+1]=l;q[ac]=q[ac+1]=N;p++}if(J[ac+1]===Q[z]&&q[ac+1]===A[z]){z--;Q[z]=J[ac];A[z]=q[ac];J[ac]=J[ac+1]=l;q[ac]=q[ac+1]=N;p++}}if(p==0){break}}if((z+1<C)&&(z>=0)){u(F,Q,A,z,C,Z)}R=0;for(ac=2;ac<ad;ac+=2){if(J[ac]!==l&&q[ac]!==N){R=ac;break}}if(R===0){break}}}};a.TH2Painter.prototype.DrawBinsContour=function(h,e){var g=this.PrepareColorDraw({rounding:false,extra:100});this.getContourIndex(0);var f=this.fContour,d=this.GetPalette(),c=this;if(this.options.Contour===14){this.draw_g.append("svg:rect").attr("x",0).attr("y",0).attr("width",h).attr("height",e).style("fill",d[Math.floor(0.99*d.length/(f.length-1))])}this.BuildContour(g,f,d,function(t,o,j,q,p){var s=d[t],m=s,r=null;switch(c.options.Contour){case 1:break;case 11:m="none";r=a.Painter.createAttLine(s);break;case 12:m="none";r=a.Painter.createAttLine({fLineColor:1,fLineStyle:(t%5+1),fLineWidth:1});break;case 13:m="none";r=c.lineatt;break;case 14:break}var l="M"+o[q]+","+j[q];for(i=q+1;i<=p;++i){l+="l"+(o[i]-o[i-1])+","+(j[i]-j[i-1])}if(m!=="none"){l+="Z"}var k=c.draw_g.append("svg:path").attr("class","th2_contour").attr("d",l).style("fill",m);if(r!==null){k.call(r.func)}else{k.style("stroke","none")}});g.hide_only_zeros=true;return g};a.TH2Painter.prototype.CreatePolyBin=function(m,r){var g="",d,c=1,f=null;if(r.fPoly._typename=="TMultiGraph"){c=r.fPoly.fGraphs.arr.length}else{f=r.fPoly}for(d=0;d<c;++d){if(!f||(d>0)){f=r.fPoly.fGraphs.arr[d]}var q=f.fNpoints,e,p=f.fX,o=f.fY,j=Math.round(m.grx(p[0])),h=Math.round(m.gry(o[0])),l,k;if((q>2)&&(p[0]==p[q-1])&&(o[0]==o[q-1])){q--}g+="M"+j+","+h;for(e=1;e<q;++e){l=Math.round(m.grx(p[e]));k=Math.round(m.gry(o[e]));if((j!==l)||(h!==k)){if(j===l){g+="v"+(k-h)}else{if(h===k){g+="h"+(l-j)}else{g+="l"+(l-j)+","+(k-h)}}}j=l;h=k}g+="z"}return g};a.TH2Painter.prototype.DrawPolyBinsColor=function(l,g){var e=this.GetObject(),k=this.main_painter(),d=[],m,c,p,o,f,j=e.fBins.arr.length;this.fContour=null;this.fCustomContour=false;this.maxbin=this.gmaxbin;this.minbin=this.gminbin;this.minposbin=this.gminposbin;for(f=0;f<j;++f){p=e.fBins.arr[f];m=this.getValueColor(p.fContent,true);if(m===null){continue}if((p.fContent===0)&&(this.options.Color===11)){continue}if((p.fXmin>k.scale_xmax)||(p.fXmax<k.scale_xmin)||(p.fYmin>k.scale_ymax)||(p.fYmax<k.scale_ymin)){continue}c=this.CreatePolyBin(k,p);if(d[m]===undefined){d[m]=c}else{d[m]+=c}}for(m=0;m<d.length;++m){if(d[m]!==undefined){o=this.draw_g.append("svg:path").attr("palette-index",m).attr("fill",this.fPalette[m]).attr("d",d[m]);if(this.options.Line){o.call(this.lineatt.func)}}}return{poly:true}};a.TH2Painter.prototype.DrawBinsText=function(k,u,y){var m=this.GetObject(),t,r,l,e,o,A,v,q,p,z,x;if(y===null){y=this.PrepareColorDraw({rounding:false})}var c=a.Painter.root_colors[m.fMarkerColor],f=(this.options.Text>1000)?this.options.Text%1000:0,s=this.draw_g.append("svg:g").attr("class","th2_text"),g=20,d=0;if((m.fMarkerSize!==1)&&(f!==0)){g=Math.round(0.02*u*m.fMarkerSize)}if(m.fBarOffset!==0){d=m.fBarOffset*0.001}this.StartTextDrawing(42,g,s,g);for(t=y.i1;t<y.i2;++t){for(r=y.j1;r<y.j2;++r){l=m.getBinContent(t+1,r+1);if((l===0)&&!this._show_empty_bins){continue}o=y.grx[t+1]-y.grx[t];A=y.gry[r]-y.gry[r+1];if((this.options.Text>=2000)&&(this.options.Text<3000)&&this.MatchObjectType("TProfile2D")&&(typeof m.getBinEntries=="function")){l=m.getBinEntries(t+1,r+1)}v=Math.round(l);if(v===l){v=l.toString()}else{v=a.FFormat(l,a.gStyle.fPaintTextFormat)}if((f!==0)){q=Math.round(y.grx[t]+o*0.5);p=Math.round(y.gry[r+1]+A*(0.5+d));z=0;x=f-360}else{q=Math.round(y.grx[t]+o*0.1);p=Math.round(y.gry[r+1]+A*(0.1+d));z=Math.round(o*0.8);x=Math.round(A*0.8)}this.DrawText(22,q,p,z,x,v,c,0,s)}}this.FinishTextDrawing(s,null);y.hide_only_zeros=true;return y};a.TH2Painter.prototype.DrawBinsArrow=function(m,C){var q=this.GetObject(),z,x,p,k,r,J,E,H,t=1e-30,o,l,v,c,F,f,D,B,e,d,s,I,g;var G=this.PrepareColorDraw({rounding:false});var A=(G.grx[G.i2]-G.grx[G.i1])/(G.i2-G.i1+1-0.03)/2,y=(G.gry[G.j2]-G.gry[G.j1])/(G.j2-G.j1+1-0.03)/2;var u="";for(var H=0;H<2;++H){for(z=G.i1;z<G.i2;++z){for(x=G.j1;x<G.j2;++x){if(z===G.i1){o=q.getBinContent(z+2,x+1)-q.getBinContent(z+1,x+1)}else{if(z===G.i2-1){o=q.getBinContent(z+1,x+1)-q.getBinContent(z,x+1)}else{o=0.5*(q.getBinContent(z+2,x+1)-q.getBinContent(z,x+1))}}if(x===G.j1){l=q.getBinContent(z+1,x+2)-q.getBinContent(z+1,x+1)}else{if(x===G.j2-1){l=q.getBinContent(z+1,x+1)-q.getBinContent(z+1,x)}else{l=0.5*(q.getBinContent(z+1,x+2)-q.getBinContent(z+1,x))}}if(H===0){t=Math.max(t,Math.abs(o),Math.abs(l))}else{v=(G.grx[z]+G.grx[z+1])/2;c=(G.gry[x]+G.gry[x+1])/2;F=A*o/t;f=y*l/t;D=v-F;B=v+F;e=c-f;d=c+f;o=Math.round(B-D);l=Math.round(d-e);if((o!==0)||(l!==0)){u+="M"+Math.round(D)+","+Math.round(e)+"l"+o+","+l;if(Math.abs(o)>5||Math.abs(l)>5){s=Math.sqrt(2/(o*o+l*l));I=Math.round(s*(o+l));g=Math.round(s*(o-l));if((I!==0)&&(g!==0)){u+="l"+(-I)+","+g+"m"+I+","+(-g)+"l"+(-g)+","+(-I)}}}}}}}this.draw_g.append("svg:path").attr("class","th2_arrows").attr("d",u).style("fill","none").call(this.lineatt.func);return G};a.TH2Painter.prototype.DrawBinsBox=function(z,G){var B=this.GetObject(),L=this.PrepareColorDraw({rounding:false}),x=this.main_painter();if(x===this){if(x.maxbin===x.minbin){x.maxbin=x.gmaxbin;x.minbin=x.gminbin;x.minposbin=x.gminposbin}if(x.maxbin===x.minbin){x.minbin=Math.min(0,x.maxbin-1)}}var q=Math.max(Math.abs(x.maxbin),Math.abs(x.minbin)),g=Math.max(0,x.minbin),F,D,A,r,O="",m="",o="",l="",y,H,f,e,v,C,N,p,d,c,t=1,K=false,E=0,I=1;if(this.root_pad().fLogz&&(q>0)){K=true;I=Math.log(q);if(g>0){E=Math.log(g)}else{if((x.minposbin>=1)&&(x.minposbin<100)){E=Math.log(0.7)}else{E=(x.minposbin>0)?Math.log(0.7*x.minposbin):I-10}}if(E>=I){E=I-10}t=1/(I-E)}else{t=1/(q-g)}for(F=L.i1;F<L.i2;++F){for(D=L.j1;D<L.j2;++D){A=B.getBinContent(F+1,D+1);r=Math.abs(A);if((r===0)||(r<g)){continue}H=K?((r>0)?Math.log(r)-E:0):(r-g);H=0.5*((H<0)?1:(1-Math.sqrt(H*t)));if(H<0){H=0}N=L.grx[F+1]-L.grx[F];p=L.gry[D]-L.gry[D+1];f=H*N;e=H*p;v=Math.round(L.grx[F]+f);C=Math.round(L.gry[D+1]+e);N=Math.max(Math.round(N-2*f),1);p=Math.max(Math.round(p-2*e),1);O+="M"+v+","+C+"v"+p+"h"+N+"v-"+p+"z";if((A<0)&&(this.options.Box===10)){m+="M"+v+","+C+"l"+N+","+p+"M"+(v+N)+","+C+"l-"+N+","+p}if((this.options.Box===11)&&(N>5)&&(p>5)){var M=Math.round(N*0.1),k=Math.round(p*0.1),u="M"+v+","+C+"h"+N+"l"+(-M)+","+k+"h"+(2*M-N)+"v"+(p-2*k)+"l"+(-M)+","+k+"z",s="M"+(v+N)+","+(C+p)+"v"+(-p)+"l"+(-M)+","+k+"v"+(p-2*k)+"h"+(2*M-N)+"l"+(-M)+","+k+"z";if(A<0){l+=u;o+=s}else{o+=u;l+=s}}}}if(O.length>0){var J=this.draw_g.append("svg:path").attr("d",O).call(this.fillatt.func);if((this.options.Box===11)||(this.fillatt.color!=="none")){J.style("stroke","none")}else{J.call(this.lineatt.func)}}if((o.length>0)&&(this.fillatt.color!=="none")){this.draw_g.append("svg:path").attr("d",o).style("stroke","none").call(this.fillatt.func).style("fill",b.rgb(this.fillatt.color).brighter(0.5).toString())}if(l.length>0){this.draw_g.append("svg:path").attr("d",l).style("stroke","none").call(this.fillatt.func).style("fill",this.fillatt.color==="none"?"red":b.rgb(this.fillatt.color).darker(0.5).toString())}if(m.length>0){var J=this.draw_g.append("svg:path").attr("d",m).style("fill","none");if(this.lineatt.color!=="none"){J.call(this.lineatt.func)}else{J.style("stroke","black")}}return L};a.TH2Painter.prototype.DrawCandle=function(k,q){var l=this.GetObject(),t=this.PrepareColorDraw(),s=this.root_pad(),e=this.main_painter(),p,o,f,z,v,u,d,x,g,c,k,A;var m="",r="";if(!this.markeratt){if(l.fMarkerColor===1){l.fMarkerColor=l.fLineColor}this.markeratt=a.Painter.createAttMarker(l,5)}this.markeratt.reset_pos();t.candle=[];for(p=t.i1;p<t.i2;++p){v=0;c=0;g=0;for(o=0;o<this.nbinsy;++o){c+=l.getBinContent(p+1,o+1)}A={bin:p,meany:0,m25y:0,p25y:0,median:0,iqr:0,whiskerp:0,whiskerm:0};for(o=0;o<this.nbinsy;++o){d=l.getBinContent(p+1,o+1);if(g/c<0.001&&(g+d)/c>=0.001){A.whiskerm=this.GetBinY(o+0.5)}if(g/c<0.25&&(g+d)/c>=0.25){A.m25y=this.GetBinY(o+0.5)}if(g/c<0.5&&(g+d)/c>=0.5){A.median=this.GetBinY(o+0.5)}if(g/c<0.75&&(g+d)/c>=0.75){A.p25y=this.GetBinY(o+0.5)}if(g/c<0.999&&(g+d)/c>=0.999){A.whiskerp=this.GetBinY(o+0.5)}g+=d;f=this.GetBinY(o+0.5);v+=d*f}if(g>0){A.meany=v/g}A.iqr=A.p25y-A.m25y;if((A.m25y-1.5*A.iqr)>A.whsikerm){A.whiskerm=A.m25y-1.5*A.iqr}if((A.p25y+1.5*A.iqr)<A.whiskerp){A.whiskerp=A.p25y+1.5*A.iqr}if(e.logy&&(A.whiskerm<=0)){continue}k=t.grx[p+1]-t.grx[p];k*=0.66;x=(t.grx[p+1]+t.grx[p])/2+l.fBarOffset/1000*k;if(l.fBarWidth>0){k=k*l.fBarWidth/1000}A.x1=Math.round(x-k/2);A.x2=Math.round(x+k/2);x=Math.round(x);A.y0=Math.round(e.gry(A.median));m+="M"+A.x1+","+A.y0+"h"+(A.x2-A.x1);A.y1=Math.round(e.gry(A.p25y));A.y2=Math.round(e.gry(A.m25y));m+="M"+A.x1+","+A.y1+"v"+(A.y2-A.y1)+"h"+(A.x2-A.x1)+"v-"+(A.y2-A.y1)+"z";A.yy1=Math.round(e.gry(A.whiskerp));A.yy2=Math.round(e.gry(A.whiskerm));m+="M"+x+","+A.y1+"v"+(A.yy1-A.y1);m+="M"+A.x1+","+A.yy1+"h"+(A.x2-A.x1);m+="M"+x+","+A.y2+"v"+(A.yy2-A.y2);m+="M"+A.x1+","+A.yy2+"h"+(A.x2-A.x1);for(o=0;o<this.nbinsy;++o){d=l.getBinContent(p+1,o+1);if(d>0&&this.GetBinY(o+0.5)<A.whiskerm){r+=this.markeratt.create(x,this.GetBinY(o+0.5))}if(d>0&&this.GetBinY(o+0.5)>A.whiskerp){r+=this.markeratt.create(x,this.GetBinY(o+0.5))}}t.candle.push(A)}if(m.length>0){this.draw_g.append("svg:path").attr("d",m).call(this.lineatt.func).call(this.fillatt.func)}if(r.length>0){this.draw_g.append("svg:path").attr("d",r).call(this.markeratt.func)}return t};a.TH2Painter.prototype.DrawBinsScatter=function(o,E){var s=this.GetObject(),I=this.PrepareColorDraw({rounding:true,pixel_density:true}),J=[],H=[],G=[],f=[],m=[],l,e,c,D,B,r,g,p,t=1,L=this.options.ScatCoef*((this.gmaxbin)>2000?2000/this.gmaxbin:1);if(L*I.sumz<100000){if(!this.markeratt){this.markeratt=a.Painter.createAttMarker(s)}this.markeratt.reset_pos();var u="",x,q;for(D=I.i1;D<I.i2;++D){g=I.grx[D+1]-I.grx[D];for(B=I.j1;B<I.j2;++B){p=I.gry[B]-I.gry[B+1];r=s.getBinContent(D+1,B+1);q=Math.round(L*r);if(q<=0){continue}for(x=0;x<q;++x){u+=this.markeratt.create(Math.round(I.grx[D]+g*Math.random()),Math.round(I.gry[B+1]+p*Math.random()))}}}this.draw_g.append("svg:path").attr("d",u).call(this.markeratt.func);return I}if(this.maxbin>0.7){t=0.7/this.maxbin}var A=Math.round(I.max-I.min);this.CreateContour((A>50)?50:A,this.minposbin,this.maxbin,this.minposbin);for(D=I.i1;D<I.i2;++D){for(B=I.j1;B<I.j2;++B){r=s.getBinContent(D+1,B+1);if((r<=0)||(r<this.minbin)){continue}g=I.grx[D+1]-I.grx[D];p=I.gry[B]-I.gry[B+1];if(g*p<=0){continue}l=this.getContourIndex(r/g/p);if(l<0){continue}e="M"+I.grx[D]+","+I.gry[B+1];if(J[l]===undefined){J[l]=e;f[l]=g;m[l]=p}else{c="m"+(I.grx[D]-H[l])+","+(I.gry[B+1]-G[l]);J[l]+=(c.length<e.length)?c:e;f[l]=Math.max(f[l],g);m[l]=Math.max(m[l],p)}H[l]=I.grx[D];G[l]=I.gry[B+1];J[l]+="v"+p+"h"+g+"v-"+p+"z"}}var K=this.svg_frame().select(".main_layer");var d=K.select("defs");if(d.empty()&&(J.length>0)){d=K.insert("svg:defs",":first-child")}if(!this.markeratt){this.markeratt=a.Painter.createAttMarker(s)}for(l=0;l<J.length;++l){if((J[l]!==undefined)&&(l<this.fContour.length)){var z="scatter_"+l;var F=d.select("."+z);if(F.empty()){F=d.append("svg:pattern").attr("class",z).attr("id","jsroot_scatter_pattern_"+a.id_counter++).attr("patternUnits","userSpaceOnUse")}else{F.selectAll("*").remove()}var q=Math.round(t*this.fContour[l]*f[l]*m[l]);if(q<1){q=1}var C=new Float32Array(q),y=new Float32Array(q);if(q===1){C[0]=y[0]=0.5}else{for(var v=0;v<q;++v){C[v]=Math.random();y[v]=Math.random()}}this.markeratt.reset_pos();var u="";for(var v=0;v<q;++v){u+=this.markeratt.create(C[v]*f[l],y[v]*m[l])}F.attr("width",f[l]).attr("height",m[l]).append("svg:path").attr("d",u).call(this.markeratt.func);this.draw_g.append("svg:path").attr("scatter-index",l).attr("fill","url(#"+F.attr("id")+")").attr("d",J[l])}}return I};a.TH2Painter.prototype.DrawBins=function(){this.CheckHistDrawAttributes();this.RecreateDrawG(false,"main_layer");var c=this.frame_width(),d=this.frame_height(),e=null;if(this.options.Color+this.options.Box+this.options.Scat+this.options.Text+this.options.Contour+this.options.Arrow+this.options.Candle.length==0){this.options.Scat=1}if(this.IsTH2Poly()){e=this.DrawPolyBinsColor(c,d)}else{if(this.options.Color>0){e=this.DrawBinsColor(c,d)}else{if(this.options.Scat>0){e=this.DrawBinsScatter(c,d)}else{if(this.options.Box>0){e=this.DrawBinsBox(c,d)}else{if(this.options.Arrow>0){e=this.DrawBinsArrow(c,d)}else{if(this.options.Contour>0){e=this.DrawBinsContour(c,d)}else{if(this.options.Candle.length>0){e=this.DrawCandle(c,d)}}}}}}}if(this.options.Text>0){e=this.DrawBinsText(c,d,e)}this.tt_handle=e};a.TH2Painter.prototype.GetBinTips=function(g,f){var d=[],c=this.main_painter();d.push(this.GetTipName());if(c.x_kind=="labels"){d.push("x = "+c.AxisAsText("x",this.GetBinX(g)))}else{d.push("x = ["+c.AxisAsText("x",this.GetBinX(g))+", "+c.AxisAsText("x",this.GetBinX(g+1))+")")}if(c.y_kind=="labels"){d.push("y = "+c.AxisAsText("y",this.GetBinY(f)))}else{d.push("y = ["+c.AxisAsText("y",this.GetBinY(f))+", "+c.AxisAsText("y",this.GetBinY(f+1))+")")}d.push("bin = "+g+", "+f);var e=this.GetObject(),h=e.getBinContent(g+1,f+1);if(e.$baseh){h-=e.$baseh.getBinContent(g+1,f+1)}if(h===Math.round(h)){d.push("entries = "+h)}else{d.push("entries = "+a.FFormat(h,a.gStyle.fStatFormat))}return d};a.TH2Painter.prototype.GetCandleTips=function(e){var d=[],c=this.main_painter();d.push(this.GetTipName());d.push("x = "+c.AxisAsText("x",this.GetBinX(e.bin)));d.push("mean y = "+a.FFormat(e.meany,a.gStyle.fStatFormat));d.push("m25 = "+a.FFormat(e.m25y,a.gStyle.fStatFormat));d.push("p25 = "+a.FFormat(e.p25y,a.gStyle.fStatFormat));return d};a.TH2Painter.prototype.ProvidePolyBinHints=function(g,c,l){var m=this.histo.fBins.arr[g],j=this.main_painter(),k=m.fPoly.fName,o=[],h=0;if(k==="Graph"){k=""}if(k.length===0){k=m.fNumber}if((c===undefined)&&(l===undefined)){c=l=0;var f=m.fPoly,e=1;if(f._typename==="TMultiGraph"){e=m.fPoly.fGraphs.arr.length;f=null}for(var d=0;d<e;++d){if(!f||(d>0)){f=m.fPoly.fGraphs.arr[d]}for(n=0;n<f.fNpoints;++n){++h;c+=f.fX[n];l+=f.fY[n]}}if(h>1){c=c/h;l=l/h}}o.push(this.GetTipName());o.push("x = "+j.AxisAsText("x",c));o.push("y = "+j.AxisAsText("y",l));if(h>0){o.push("npnts = "+h)}o.push("bin = "+k);o.push("content = "+a.FFormat(m.fContent,a.gStyle.fStatFormat));return o};a.TH2Painter.prototype.ProcessTooltip=function(z){if(!z||!this.draw_content||!this.draw_g||!this.tt_handle){if(this.draw_g!==null){this.draw_g.select(".tooltip_bin").remove()}this.ProvideUserTooltip(null);return null}var m=this.GetObject(),x=this.tt_handle,v,y=this.draw_g.select(".tooltip_bin");if(x.poly){var g=this.main_painter(),e,d,c=-1;if(g.grx===g.x){e=g.x.invert(z.x)}if(g.gry===g.y){d=g.y.invert(z.y)}if((e!==undefined)&&(d!==undefined)){var v,w=m.fBins.arr.length,q;for(v=0;(v<w)&&(c<0);++v){q=m.fBins.arr[v];if((e<q.fXmin)||(e>q.fXmax)||(d<q.fYmin)||(d>q.fYmax)){continue}if((q.fContent===0)&&(this.options.Color===11)){continue}var t=q.fPoly,r=1;if(t._typename==="TMultiGraph"){r=q.fPoly.fGraphs.arr.length;t=null}for(var k=0;k<r;++k){if(!t||(k>0)){t=q.fPoly.fGraphs.arr[k]}if(t.IsInside(e,d)){c=v;break}}}}if(c<0){y.remove();this.ProvideUserTooltip(null);return null}var A={name:m.fName,title:m.fTitle,x:z.x,y:z.y,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.color:"blue",exact:true,menu:true,lines:this.ProvidePolyBinHints(c,e,d)};if(z.disabled){y.remove();A.changed=true}else{if(y.empty()){y=this.draw_g.append("svg:path").attr("class","tooltip_bin h1bin").style("pointer-events","none")}A.changed=y.property("current_bin")!==c;if(A.changed){y.attr("d",this.CreatePolyBin(g,q)).style("opacity","0.7").property("current_bin",c)}}if(this.IsUserTooltipCallback()&&A.changed){this.ProvideUserTooltip({obj:m,name:m.fName,bin:c,cont:q.fContent,grx:z.x,gry:z.y})}return A}else{if(x.candle){var s;for(v=0;v<x.candle.length;++v){s=x.candle[v];if((s.x1<=z.x)&&(z.x<=s.x2)&&(s.yy1<=z.y)&&(z.y<=s.yy2)){break}}if(v>=x.candle.length){y.remove();this.ProvideUserTooltip(null);return null}var A={name:m.fName,title:m.fTitle,x:z.x,y:z.y,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.color:"blue",lines:this.GetCandleTips(s),exact:true,menu:true};if(z.disabled){y.remove();A.changed=true}else{if(y.empty()){y=this.draw_g.append("svg:rect").attr("class","tooltip_bin h1bin").style("pointer-events","none")}A.changed=y.property("current_bin")!==v;if(A.changed){y.attr("x",s.x1).attr("width",s.x2-s.x1).attr("y",s.yy1).attr("height",s.yy2-s.yy1).style("opacity","0.7").property("current_bin",v)}}if(this.IsUserTooltipCallback()&&A.changed){this.ProvideUserTooltip({obj:m,name:m.fName,bin:v+1,cont:s.median,binx:v+1,biny:1,grx:z.x,gry:z.y})}return A}}var v,u,o=0,l=0,f=null;for(v=x.i1;v<x.i2;++v){if((z.x>=x.grx[v])&&(z.x<=x.grx[v+1])){++o;break}}for(u=x.j1;u<=x.j2;++u){if((z.y>=x.gry[u+1])&&(z.y<=x.gry[u])){++o;break}}if(o===2){l=m.getBinContent(v+1,u+1);if(x.hide_only_zeros){f=(l===0)&&!this._show_empty_bins?null:0}else{f=this.getValueColor(l,true);if((f===null)&&(l===0)&&this._show_empty_bins){f=0}}}if(f===null){y.remove();this.ProvideUserTooltip(null);return null}var A={name:m.fName,title:m.fTitle,x:z.x,y:z.y,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.color:"blue",lines:this.GetBinTips(v,u),exact:true,menu:true};if(this.options.Color>0){A.color2=this.GetPalette()[f]}if(z.disabled){y.remove();A.changed=true}else{if(y.empty()){y=this.draw_g.append("svg:rect").attr("class","tooltip_bin h1bin").style("pointer-events","none")}A.changed=y.property("current_bin")!==v*10000+u;if(A.changed){y.attr("x",x.grx[v]).attr("width",x.grx[v+1]-x.grx[v]).attr("y",x.gry[u+1]).attr("height",x.gry[u]-x.gry[u+1]).style("opacity","0.7").property("current_bin",v*10000+u)}}if(this.IsUserTooltipCallback()&&A.changed){this.ProvideUserTooltip({obj:m,name:m.fName,bin:m.getBin(v+1,u+1),cont:l,binx:v+1,biny:u+1,grx:z.x,gry:z.y})}return A};a.TH2Painter.prototype.CanZoomIn=function(e,d,c){if((e=="x")&&(this.GetIndexX(c,0.5)-this.GetIndexX(d,0)>1)){return true}if((e=="y")&&(this.GetIndexY(c,0.5)-this.GetIndexY(d,0)>1)){return true}if(e=="z"){return true}return false};a.TH2Painter.prototype.Draw2D=function(e,d){this.mode3d=false;if(typeof this.Create3DScene=="function"){this.Create3DScene(-1)}this.CreateXY();var c=this.DrawColorPalette((this.options.Zscale>0)&&((this.options.Color>0)||(this.options.Contour>0)),true);this.DrawAxes();this.DrawGrids();this.DrawBins();if(c){c.DrawPave()}this.DrawTitle();this.UpdateStatWebCanvas();this.AddInteractive();a.CallBack(e)};a.TH2Painter.prototype.Draw3D=function(c){this.mode3d=true;a.AssertPrerequisites("3d",function(){this.Create3DScene=a.Painter.HPainter_Create3DScene;this.Draw3D=a.Painter.TH2Painter_Draw3D;this.Draw3D(c)}.bind(this))};a.TH2Painter.prototype.CallDrawFunc=function(g,e){var d=this.main_painter(),f=false;if((this.options.Contour>0)&&(d!==this)){f=d.mode3d}else{if((this.options.Lego>0)||(this.options.Surf>0)||(this.options.Error>0)){f=true}}if((d!==this)&&(f!==d.mode3d)){f=d.mode3d;this.options.Lego=d.options.Lego;this.options.Surf=d.options.Surf;this.options.Error=d.options.Error}var c=f?"Draw3D":"Draw2D";this[c](g,e)};a.TH2Painter.prototype.Redraw=function(c){this.CallDrawFunc(null,c)};a.Painter.drawHistogram2D=function(e,c,d){a.extend(this,new a.TH2Painter(c));this.SetDivId(e,1);this.options=this.DecodeOptions(d);if(this.IsTH2Poly()){if(this.options.Lego){this.options.Lego=12}else{if(!this.options.Color){this.options.Color=1}}}this._show_empty_bins=false;this._can_move_colz=true;if((this.options.Contour!==14)&&!this.options.Lego&&!this.options.Surf){this.CheckPadRange()}this.ScanContent();if(a.gStyle.AutoStat&&(this.create_canvas||c.$snapid)){this.CreateStat(c.$custom_stat)}this.CallDrawFunc(function(){this.DrawNextFunction(0,function(){if((this.options.Lego<=0)&&(this.options.Surf<=0)){if(this.options.AutoZoom){this.AutoZoom()}}this.FillToolbar();this.DrawingReady()}.bind(this))}.bind(this));return this};a.Painter.drawWebPainting=function(e,d,c){this.UpdateObject=function(f){if(!this.MatchObjectType(f)){return false}this.draw_object=f;return true};this.Redraw=function(){var m=this.GetObject(),v=null,C=0,B=null,u=null,p=null;if(!m||!m.fOper){return}this.RecreateDrawG(true,"special_layer");for(var x=0;x<m.fOper.arr.length;++x){var l=m.fOper.opt[x];switch(l){case"attr":v=m.fOper.arr[x];B=u=p=null;continue;case"rect":case"box":var A=this.AxisToSvg("x",m.fBuf[C++]),h=this.AxisToSvg("y",m.fBuf[C++]),z=this.AxisToSvg("x",m.fBuf[C++]),g=this.AxisToSvg("y",m.fBuf[C++]);if(!B){B=a.Painter.createAttLine(v)}var f=this.draw_g.append("svg:rect").attr("x",Math.min(A,z)).attr("y",Math.min(h,g)).attr("width",Math.abs(z-A)).attr("height",Math.abs(h-g)).call(B.func);if(l==="box"){if(!u){u=this.createAttFill(v)}f.call(u.func)}continue;case"line":case"linendc":var w=(l==="linendc"),A=this.AxisToSvg("x",m.fBuf[C++],w),h=this.AxisToSvg("y",m.fBuf[C++],w),z=this.AxisToSvg("x",m.fBuf[C++],w),g=this.AxisToSvg("y",m.fBuf[C++],w);if(!B){B=a.Painter.createAttLine(v)}this.draw_g.append("svg:line").attr("x1",A).attr("y1",h).attr("x2",z).attr("y2",g).call(B.func);continue;case"polyline":case"polylinendc":case"fillarea":var s=parseInt(m.fOper.arr[x].fString),y="";if(!B){B=a.Painter.createAttLine(v)}for(var t=0;t<s;++t){y+=((t>0)?"L":"M")+this.AxisToSvg("x",m.fBuf[C++],false)+","+this.AxisToSvg("y",m.fBuf[C++],false)}if(l=="fillarea"){y+="Z"}var r=this.draw_g.append("svg:path").attr("d",y).call(B.func);if(l=="fillarea"){if(!u){u=this.createAttFill(v)}r.call(u.func)}continue;case"polymarker":var s=parseInt(m.fOper.arr[x].fString),y="";if(!p){p=a.Painter.createAttMarker(v)}p.reset_pos();for(var t=0;t<s;++t){y+=p.create(this.AxisToSvg("x",m.fBuf[C++],false),this.AxisToSvg("y",m.fBuf[C++],false))}if(y){this.draw_g.append("svg:path").attr("d",y).call(p.func)}continue;case"text":case"textndc":var w=(l==="textndc"),j=this.AxisToSvg("x",m.fBuf[C++],w),q=this.AxisToSvg("y",m.fBuf[C++],w);if(v){var o=(v.fTextSize>1)?v.fTextSize:this.pad_height()*v.fTextSize;this.StartTextDrawing(v.fTextFont,o);this.DrawText(v.fTextAlign,j,q,0,0,m.fOper.arr[x].fString,a.Painter.root_colors[v.fTextColor]);this.FinishTextDrawing()}continue;default:console.log("unsupported operation",l)}}};this.SetDivId(e);this.options=c;this.Redraw();return this.DrawingReady()};return a.Painter}));